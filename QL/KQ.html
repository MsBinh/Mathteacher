<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>T·ªïng h·ª£p k·∫øt qu·∫£ H·ªôi thi STEM & KHKT - THPT Tr·∫ßn Tr∆∞·ªùng Sinh</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
  body { background:#f8f9fa; }
  .container { max-width:1400px; margin-top:30px; margin-bottom:40px; }
  h2,h3 { text-align:center; }
  .section-card { margin-bottom:40px; }
  .table th, .table td { vertical-align: middle; }
  .iqr-header { background:#0066cc; color:white; }
  .loading { text-align: center; padding: 20px; }
  .error { color: red; text-align: center; }
  .medal-gold { color: #ffd700; font-weight: bold; }
  .medal-silver { color: #c0c0c0; font-weight: bold; }
  .medal-bronze { color: #cd7f32; font-weight: bold; }
  /* N√∫t quay v·ªÅ trang ch·ªß */
.home-button {
  position: fixed;
  top: 20px;
  left: 20px;
  z-index: 1000;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  border: none;
  border-radius: 50px;
  padding: 12px 20px;
  font-weight: 600;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
  transition: all 0.3s ease;
  text-decoration: none;
  display: inline-flex;
  align-items: center;
  gap: 8px;
}

.home-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
  color: white;
  text-decoration: none;
}

.home-button:active {
  transform: translateY(0);
}

/* Responsive cho mobile */
@media (max-width: 768px) {
  .home-button {
    top: 10px;
    left: 10px;
    padding: 10px 16px;
    font-size: 14px;
  }
}

/* Phi√™n b·∫£n n√∫t nh·ªè h∆°n cho c√°c trang c·∫ßn nhi·ªÅu kh√¥ng gian */
.home-button-sm {
  padding: 8px 16px;
  font-size: 14px;
</style>
</head>
<body>
<div class="container">
  <h2 class="text-primary mb-4 fw-bold">üèÜ T·ªîNG H·ª¢P K·∫æT QU·∫¢ H·ªòI THI STEM & KHKT<br>Tr∆∞·ªùng THPT Tr·∫ßn Tr∆∞·ªùng Sinh</h2>
   <a href="index.html" class="home-button" title="Quay v·ªÅ trang ch√≠nh">
  üè† Trang ch√≠nh
  </a>
  <!-- Loading Indicator -->
  <div id="loading" class="loading">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">ƒêang t·∫£i...</span>
    </div>
    <p class="mt-2">ƒêang k·∫øt n·ªëi ƒë·∫øn c∆° s·ªü d·ªØ li·ªáu...</p>
  </div>

  <!-- STEM Section -->
  <div class="section-card card shadow-sm" id="stem-section" style="display: none;">
    <div class="card-header bg-success text-white fw-bold text-center fs-5">üåø K·∫æT QU·∫¢ H·ªòI THI STEM</div>
    <div class="card-body">
      <h5 class="text-success">üìã B·∫£ng ch·∫•m ƒëi·ªÉm chi ti·∫øt</h5>
      <div class="table-responsive mb-4">
        <table class="table table-bordered table-striped" id="stem-detailed">
          <thead class="table-light text-center">
            <tr><th>#</th><th>STT</th><th>T√™n d·ª± √°n</th><th>M√£ GK</th><th>Gi√°m kh·∫£o</th>
            <th>√ù t∆∞·ªüng</th><th>STEM</th><th>Quy tr√¨nh</th><th>S·∫£n ph·∫©m</th>
            <th>Thuy·∫øt tr√¨nh</th><th>Nh√≥m</th><th>T·ªïng</th></tr>
          </thead>
          <tbody><tr><td colspan="12" class="text-center text-muted">ƒêang t·∫£i...</td></tr></tbody>
        </table>
      </div>

      <h5 class="text-success">üèÖ B·∫£ng x·∫øp h·∫°ng theo ƒëi·ªÉm trung b√¨nh</h5>
      <div class="table-responsive mb-4">
        <table class="table table-hover" id="stem-leaderboard">
          <thead class="table-light text-center">
            <tr><th>H·∫°ng</th><th>STT</th><th>T√™n d·ª± √°n</th><th>L∆∞·ª£t ch·∫•m</th><th>ƒêi·ªÉm TB</th></tr>
          </thead>
          <tbody><tr><td colspan="5" class="text-center text-muted">ƒêang t·∫£i...</td></tr></tbody>
        </table>
      </div>

      <h5 class="text-primary">üìà B·∫£ng x·∫øp h·∫°ng sau khi l·ªçc ngo·∫°i l·ªá (IQR)</h5>
      <div class="table-responsive">
        <table class="table table-hover" id="stem-iqr">
          <thead class="iqr-header text-center">
            <tr><th>H·∫°ng</th><th>STT</th><th>T√™n d·ª± √°n</th><th>T·ªïng l∆∞·ª£t</th><th>L∆∞·ª£t h·ª£p l·ªá</th><th>ƒêi·ªÉm TB (IQR)</th></tr>
          </thead>
          <tbody><tr><td colspan="6" class="text-center text-muted">ƒêang t·∫£i...</td></tr></tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- KHKT Section -->
  <div class="section-card card shadow-sm" id="science-section" style="display: none;">
    <div class="card-header bg-info text-white fw-bold text-center fs-5">üî¨ K·∫æT QU·∫¢ CU·ªòC THI NGHI√äN C·ª®U KHKT</div>
    <div class="card-body">
      <h5 class="text-info">üìã B·∫£ng ch·∫•m ƒëi·ªÉm chi ti·∫øt</h5>
      <div class="table-responsive mb-4">
        <table class="table table-bordered table-striped" id="science-detailed">
          <thead class="table-light text-center">
            <tr><th>#</th><th>STT</th><th>T√™n d·ª± √°n</th><th>M√£ GK</th><th>Gi√°m kh·∫£o</th>
            <th>C√¢u h·ªèi</th><th>Thi·∫øt k·∫ø</th><th>Th·ª±c hi·ªán</th><th>S√°ng t·∫°o</th>
            <th>Poster</th><th>Ph·ªèng v·∫•n</th><th>T·ªïng</th></tr>
          </thead>
          <tbody><tr><td colspan="12" class="text-center text-muted">ƒêang t·∫£i...</td></tr></tbody>
        </table>
      </div>

      <h5 class="text-info">üèÖ B·∫£ng x·∫øp h·∫°ng theo ƒëi·ªÉm trung b√¨nh</h5>
      <div class="table-responsive mb-4">
        <table class="table table-hover" id="science-leaderboard">
          <thead class="table-light text-center">
            <tr><th>H·∫°ng</th><th>STT</th><th>T√™n d·ª± √°n</th><th>L∆∞·ª£t ch·∫•m</th><th>ƒêi·ªÉm TB</th></tr>
          </thead>
          <tbody><tr><td colspan="5" class="text-center text-muted">ƒêang t·∫£i...</td></tr></tbody>
        </table>
      </div>

      <h5 class="text-primary">üìà B·∫£ng x·∫øp h·∫°ng sau khi l·ªçc ngo·∫°i l·ªá (IQR)</h5>
      <div class="table-responsive">
        <table class="table table-hover" id="science-iqr">
          <thead class="iqr-header text-center">
            <tr><th>H·∫°ng</th><th>STT</th><th>T√™n d·ª± √°n</th><th>T·ªïng l∆∞·ª£t</th><th>L∆∞·ª£t h·ª£p l·ªá</th><th>ƒêi·ªÉm TB (IQR)</th></tr>
          </thead>
          <tbody><tr><td colspan="6" class="text-center text-muted">ƒêang t·∫£i...</td></tr></tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Error Message -->
  <div id="error-message" class="alert alert-danger" style="display: none;">
    <h4 class="alert-heading">L·ªói k·∫øt n·ªëi</h4>
    <p id="error-text">Kh√¥ng th·ªÉ k·∫øt n·ªëi ƒë·∫øn c∆° s·ªü d·ªØ li·ªáu. Vui l√≤ng th·ª≠ l·∫°i sau.</p>
  </div>

</div>

<!-- Firebase App & Firestore -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

<script>
// C·∫•u h√¨nh Firebase
const firebaseConfig = {
  apiKey: "AIzaSyDDACFZgZazMOnjzmGM_lrKswVcsoTFHxA",
  authDomain: "veonline-3bcbf.firebaseapp.com",
  projectId: "veonline-3bcbf",
  storageBucket: "veonline-3bcbf.firebasestorage.app",
  messagingSenderId: "1097751337006",
  appId: "1:1097751337006:web:8d4e6d9c2b2d4c3d8d4e6d"
};

// Kh·ªüi t·∫°o Firebase
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// H√†m ti·ªán √≠ch
function escapeHtml(s) { 
  return s ? s.replace(/[&<>]/g, m => ({"&":"&amp;","<":"&lt;",">":"&gt;"}[m])) : ""; 
}

function quantile(arr, q) { 
  if (!arr.length) return 0; 
  const sorted = arr.slice().sort((a, b) => a - b);
  const pos = (sorted.length - 1) * q;
  const base = Math.floor(pos);
  const rest = pos - base;
  
  if (sorted[base + 1] !== undefined) {
    return sorted[base] + (sorted[base + 1] - sorted[base]) * rest;
  } else {
    return sorted[base];
  }
}

// H√†m hi·ªÉn th·ªã d·ªØ li·ªáu STEM
function renderStemData(projects, stemScores) {
  console.log(`üéØ Rendering STEM: ${stemScores.length} scores`);
  
  // 1Ô∏è‚É£ B·∫£ng chi ti·∫øt STEM
  const stemTbody = document.querySelector('#stem-detailed tbody');
  if (!stemScores.length) { 
    stemTbody.innerHTML = `<tr><td colspan="12" class="text-center text-muted">Ch∆∞a c√≥ d·ªØ li·ªáu ch·∫•m ƒëi·ªÉm STEM</td></tr>`; 
  } else {
    stemTbody.innerHTML = "";
    stemScores.forEach((score, i) => {
      const project = projects[score.projectId] || {};
      const title = project.title || "(Kh√¥ng t√™n)";
      const order = project.order || "?";
      const judgeName = score.judgeName || "Kh√¥ng x√°c ƒë·ªãnh";
      const judgeCode = score.judgeCode || "???";
      
      stemTbody.innerHTML += `
        <tr>
          <td>${i + 1}</td><td>${order}</td><td>${escapeHtml(title)}</td>
          <td>${judgeCode}</td><td>${escapeHtml(judgeName)}</td>
          <td>${score.idea || 0}</td><td>${score.applySTEM || 0}</td><td>${score.process || 0}</td>
          <td>${score.product || 0}</td><td>${score.presentation || 0}</td>
          <td>${score.teamwork || 0}</td><td class="fw-bold">${score.total || 0}</td>
        </tr>`;
    });
  }

  // 2Ô∏è‚É£ B·∫£ng x·∫øp h·∫°ng trung b√¨nh STEM
  const stemByPid = {};
  stemScores.forEach(score => {
    const pid = score.projectId;
    if (!stemByPid[pid]) stemByPid[pid] = [];
    stemByPid[pid].push(Number(score.total) || 0);
  });

  const stemLeaderboardList = Object.keys(projects)
    .map(pid => {
      const project = projects[pid];
      const scoresArr = stemByPid[pid] || [];
      const avg = scoresArr.length ? scoresArr.reduce((a, b) => a + b, 0) / scoresArr.length : 0;
      
      return {
        pid,
        order: project.order || 0,
        title: project.title || "",
        cnt: scoresArr.length,
        avg: avg
      };
    })
    .filter(x => x.cnt > 0)
    .sort((a, b) => b.avg - a.avg);

  const stemLbTbody = document.querySelector('#stem-leaderboard tbody');
  stemLbTbody.innerHTML = "";
  
  if (stemLeaderboardList.length === 0) {
    stemLbTbody.innerHTML = `<tr><td colspan="5" class="text-center text-muted">Ch∆∞a c√≥ d·ªØ li·ªáu x·∫øp h·∫°ng STEM</td></tr>`;
  } else {
    stemLeaderboardList.forEach((item, index) => {
      let rankClass = "";
      if (index === 0) rankClass = "medal-gold";
      else if (index === 1) rankClass = "medal-silver";
      else if (index === 2) rankClass = "medal-bronze";
      
      stemLbTbody.innerHTML += `
        <tr>
          <td class="${rankClass}">${index + 1}</td>
          <td>${item.order}</td>
          <td>${escapeHtml(item.title)}</td>
          <td>${item.cnt}</td>
          <td class="fw-bold text-success">${item.avg.toFixed(2)}</td>
        </tr>`;
    });
  }

  // 3Ô∏è‚É£ B·∫£ng x·∫øp h·∫°ng IQR STEM
  const stemIqrTbody = document.querySelector('#stem-iqr tbody');
  stemIqrTbody.innerHTML = "";
  
  const stemIqrList = [];
  for (const pid in stemByPid) {
    const scoresArr = stemByPid[pid].slice().sort((a, b) => a - b);
    
    if (scoresArr.length >= 3) {
      const Q1 = quantile(scoresArr, 0.25);
      const Q3 = quantile(scoresArr, 0.75);
      const IQR = Q3 - Q1;
      const lower = Q1 - 1.5 * IQR;
      const upper = Q3 + 1.5 * IQR;
      
      const filtered = scoresArr.filter(x => x >= lower && x <= upper);
      const avg = filtered.length > 0 ? 
        filtered.reduce((a, b) => a + b, 0) / filtered.length : 
        scoresArr.reduce((a, b) => a + b, 0) / scoresArr.length;
      
      stemIqrList.push({
        pid,
        order: projects[pid]?.order || 0,
        title: projects[pid]?.title || "",
        totalCount: scoresArr.length,
        validCount: filtered.length,
        avg: avg
      });
    } else {
      // N·∫øu √≠t h∆°n 3 l∆∞·ª£t ch·∫•m, d√πng trung b√¨nh th√¥ng th∆∞·ªùng
      const avg = scoresArr.reduce((a, b) => a + b, 0) / scoresArr.length;
      stemIqrList.push({
        pid,
        order: projects[pid]?.order || 0,
        title: projects[pid]?.title || "",
        totalCount: scoresArr.length,
        validCount: scoresArr.length,
        avg: avg
      });
    }
  }

  stemIqrList.sort((a, b) => b.avg - a.avg);
  
  if (stemIqrList.length === 0) {
    stemIqrTbody.innerHTML = `<tr><td colspan="6" class="text-center text-muted">Ch∆∞a c√≥ d·ªØ li·ªáu IQR STEM</td></tr>`;
  } else {
    stemIqrList.forEach((item, index) => {
      let rankClass = "";
      if (index === 0) rankClass = "medal-gold";
      else if (index === 1) rankClass = "medal-silver";
      else if (index === 2) rankClass = "medal-bronze";
      
      const outlierInfo = item.totalCount > item.validCount ? 
        ` <small class="text-danger">(-${item.totalCount - item.validCount})</small>` : "";
      
      stemIqrTbody.innerHTML += `
        <tr>
          <td class="${rankClass}">${index + 1}</td>
          <td>${item.order}</td>
          <td>${escapeHtml(item.title)}</td>
          <td>${item.totalCount}</td>
          <td>${item.validCount}${outlierInfo}</td>
          <td class="fw-bold text-primary">${item.avg.toFixed(2)}</td>
        </tr>`;
    });
  }
}

// H√†m hi·ªÉn th·ªã d·ªØ li·ªáu KHKT
function renderScienceData(projects, scienceScores) {
  console.log(`üéØ Rendering KHKT: ${scienceScores.length} scores`);
  
  // 1Ô∏è‚É£ B·∫£ng chi ti·∫øt KHKT
  const scienceTbody = document.querySelector('#science-detailed tbody');
  if (!scienceScores.length) { 
    scienceTbody.innerHTML = `<tr><td colspan="12" class="text-center text-muted">Ch∆∞a c√≥ d·ªØ li·ªáu ch·∫•m ƒëi·ªÉm KHKT</td></tr>`; 
  } else {
    scienceTbody.innerHTML = "";
    scienceScores.forEach((score, i) => {
      const project = projects[score.projectId] || {};
      const title = project.title || "(Kh√¥ng t√™n)";
      const order = project.order || "?";
      const judgeName = score.judgeName || "Kh√¥ng x√°c ƒë·ªãnh";
      const judgeCode = score.judgeCode || "???";
      
      scienceTbody.innerHTML += `
        <tr>
          <td>${i + 1}</td><td>${order}</td><td>${escapeHtml(title)}</td>
          <td>${judgeCode}</td><td>${escapeHtml(judgeName)}</td>
          <td>${score.c1 || 0}</td><td>${score.c2 || 0}</td><td>${score.c3 || 0}</td>
          <td>${score.c4 || 0}</td><td>${score.c5 || 0}</td>
          <td>${score.c6 || 0}</td><td class="fw-bold">${score.total || 0}</td>
        </tr>`;
    });
  }

  // 2Ô∏è‚É£ B·∫£ng x·∫øp h·∫°ng trung b√¨nh KHKT
  const scienceByPid = {};
  scienceScores.forEach(score => {
    const pid = score.projectId;
    if (!scienceByPid[pid]) scienceByPid[pid] = [];
    scienceByPid[pid].push(Number(score.total) || 0);
  });

  const scienceLeaderboardList = Object.keys(projects)
    .map(pid => {
      const project = projects[pid];
      const scoresArr = scienceByPid[pid] || [];
      const avg = scoresArr.length ? scoresArr.reduce((a, b) => a + b, 0) / scoresArr.length : 0;
      
      return {
        pid,
        order: project.order || 0,
        title: project.title || "",
        cnt: scoresArr.length,
        avg: avg
      };
    })
    .filter(x => x.cnt > 0)
    .sort((a, b) => b.avg - a.avg);

  const scienceLbTbody = document.querySelector('#science-leaderboard tbody');
  scienceLbTbody.innerHTML = "";
  
  if (scienceLeaderboardList.length === 0) {
    scienceLbTbody.innerHTML = `<tr><td colspan="5" class="text-center text-muted">Ch∆∞a c√≥ d·ªØ li·ªáu x·∫øp h·∫°ng KHKT</td></tr>`;
  } else {
    scienceLeaderboardList.forEach((item, index) => {
      let rankClass = "";
      if (index === 0) rankClass = "medal-gold";
      else if (index === 1) rankClass = "medal-silver";
      else if (index === 2) rankClass = "medal-bronze";
      
      scienceLbTbody.innerHTML += `
        <tr>
          <td class="${rankClass}">${index + 1}</td>
          <td>${item.order}</td>
          <td>${escapeHtml(item.title)}</td>
          <td>${item.cnt}</td>
          <td class="fw-bold text-success">${item.avg.toFixed(2)}</td>
        </tr>`;
    });
  }

  // 3Ô∏è‚É£ B·∫£ng x·∫øp h·∫°ng IQR KHKT
  const scienceIqrTbody = document.querySelector('#science-iqr tbody');
  scienceIqrTbody.innerHTML = "";
  
  const scienceIqrList = [];
  for (const pid in scienceByPid) {
    const scoresArr = scienceByPid[pid].slice().sort((a, b) => a - b);
    
    if (scoresArr.length >= 3) {
      const Q1 = quantile(scoresArr, 0.25);
      const Q3 = quantile(scoresArr, 0.75);
      const IQR = Q3 - Q1;
      const lower = Q1 - 1.5 * IQR;
      const upper = Q3 + 1.5 * IQR;
      
      const filtered = scoresArr.filter(x => x >= lower && x <= upper);
      const avg = filtered.length > 0 ? 
        filtered.reduce((a, b) => a + b, 0) / filtered.length : 
        scoresArr.reduce((a, b) => a + b, 0) / scoresArr.length;
      
      scienceIqrList.push({
        pid,
        order: projects[pid]?.order || 0,
        title: projects[pid]?.title || "",
        totalCount: scoresArr.length,
        validCount: filtered.length,
        avg: avg
      });
    } else {
      // N·∫øu √≠t h∆°n 3 l∆∞·ª£t ch·∫•m, d√πng trung b√¨nh th√¥ng th∆∞·ªùng
      const avg = scoresArr.reduce((a, b) => a + b, 0) / scoresArr.length;
      scienceIqrList.push({
        pid,
        order: projects[pid]?.order || 0,
        title: projects[pid]?.title || "",
        totalCount: scoresArr.length,
        validCount: scoresArr.length,
        avg: avg
      });
    }
  }

  scienceIqrList.sort((a, b) => b.avg - a.avg);
  
  if (scienceIqrList.length === 0) {
    scienceIqrTbody.innerHTML = `<tr><td colspan="6" class="text-center text-muted">Ch∆∞a c√≥ d·ªØ li·ªáu IQR KHKT</td></tr>`;
  } else {
    scienceIqrList.forEach((item, index) => {
      let rankClass = "";
      if (index === 0) rankClass = "medal-gold";
      else if (index === 1) rankClass = "medal-silver";
      else if (index === 2) rankClass = "medal-bronze";
      
      const outlierInfo = item.totalCount > item.validCount ? 
        ` <small class="text-danger">(-${item.totalCount - item.validCount})</small>` : "";
      
      scienceIqrTbody.innerHTML += `
        <tr>
          <td class="${rankClass}">${index + 1}</td>
          <td>${item.order}</td>
          <td>${escapeHtml(item.title)}</td>
          <td>${item.totalCount}</td>
          <td>${item.validCount}${outlierInfo}</td>
          <td class="fw-bold text-primary">${item.avg.toFixed(2)}</td>
        </tr>`;
    });
  }
}

// H√†m ch√≠nh ƒë·ªÉ t·∫£i v√† hi·ªÉn th·ªã d·ªØ li·ªáu
async function loadAll() {
  try {
    console.log("üöÄ B·∫Øt ƒë·∫ßu t·∫£i d·ªØ li·ªáu...");
    
    // L·∫•y d·ªØ li·ªáu projects
    const projectsSnapshot = await db.collection('projects').get();
    const projects = {};
    projectsSnapshot.forEach(doc => {
      projects[doc.id] = doc.data();
    });
    console.log(`üìÅ ƒê√£ t·∫£i ${Object.keys(projects).length} d·ª± √°n`);

    // L·∫•y d·ªØ li·ªáu scores STEM
    const stemScoresSnapshot = await db.collection('scores').get();
    const stemScores = [];
    stemScoresSnapshot.forEach(doc => {
      stemScores.push({
        id: doc.id,
        ...doc.data()
      });
    });
    console.log(`üìä ƒê√£ t·∫£i ${stemScores.length} b·∫£n ch·∫•m ƒëi·ªÉm STEM`);

    // L·∫•y d·ªØ li·ªáu scores KHKT
    const scienceScoresSnapshot = await db.collection('scores_khkt').get();
    const scienceScores = [];
    scienceScoresSnapshot.forEach(doc => {
      scienceScores.push({
        id: doc.id,
        ...doc.data()
      });
    });
    console.log(`üìä ƒê√£ t·∫£i ${scienceScores.length} b·∫£n ch·∫•m ƒëi·ªÉm KHKT`);

    // ·∫®n loading, hi·ªÉn th·ªã n·ªôi dung
    document.getElementById('loading').style.display = 'none';
    
    // Hi·ªÉn th·ªã section n·∫øu c√≥ d·ªØ li·ªáu
    if (stemScores.length > 0) {
      document.getElementById('stem-section').style.display = 'block';
      renderStemData(projects, stemScores);
    }
    
    if (scienceScores.length > 0) {
      document.getElementById('science-section').style.display = 'block';
      renderScienceData(projects, scienceScores);
    }
    
    // N·∫øu kh√¥ng c√≥ d·ªØ li·ªáu n√†o
    if (stemScores.length === 0 && scienceScores.length === 0) {
      document.getElementById('error-message').style.display = 'block';
      document.getElementById('error-text').textContent = 'Kh√¥ng c√≥ d·ªØ li·ªáu ch·∫•m ƒëi·ªÉm n√†o trong h·ªá th·ªëng.';
    }
    
    console.log("üéâ ƒê√£ render xong t·∫•t c·∫£ d·ªØ li·ªáu!");
    
  } catch (error) {
    console.error("üí• L·ªói trong qu√° tr√¨nh x·ª≠ l√Ω:", error);
    
    // Hi·ªÉn th·ªã th√¥ng b√°o l·ªói
    document.getElementById('loading').style.display = 'none';
    document.getElementById('error-message').style.display = 'block';
    document.getElementById('error-text').textContent = `L·ªói: ${error.message}`;
    
    // Hi·ªÉn th·ªã th√¥ng b√°o l·ªói trong c√°c b·∫£ng
    document.querySelectorAll('tbody').forEach(tbody => {
      if (tbody.innerHTML.includes('ƒêang t·∫£i')) {
        tbody.innerHTML = `<tr><td colspan="12" class="text-center text-danger">L·ªói khi t·∫£i d·ªØ li·ªáu</td></tr>`;
      }
    });
  }
}

// B·∫Øt ƒë·∫ßu t·∫£i d·ªØ li·ªáu khi trang load
document.addEventListener('DOMContentLoaded', loadAll);
</script>
</body>
</html>