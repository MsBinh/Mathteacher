<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>L·ªöP TO√ÅN TH·∫¶Y B√åNH - H·ªÜ TH·ªêNG ƒê·ªÄ THI</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="H·ªá th·ªëng d·∫°y h·ªçc To√°n tr·ª±c tuy·∫øn ƒë·∫ßy ƒë·ªß t√≠nh nƒÉng">

  <!-- 1. T·∫¢I C√ÅC TH∆Ø VI·ªÜN L·ªöN TR∆Ø·ªöC -->
    <script src="https://unpkg.com/reveal.js/dist/reveal.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- 2. C·∫§U H√åNH MATHJAX (QUAN TR·ªåNG!) -->
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$','$$'], ['\\[','\\]']]
            },
            svg: { fontCache: 'global' }
        };
    </script>

    <!-- 3. T·∫¢I MATHJAX SAU KHI ƒê√É C·∫§U H√åNH -->
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" id="mathjax-script"></script>

    <!-- 4. T·∫¢I C√ÅC PLUGIN C·ª¶A REVEAL.JS SAU C√ôNG -->
    <script src="https://unpkg.com/reveal.js/plugin/markdown/markdown.js"></script>
    <script src="https://unpkg.com/reveal.js/plugin/highlight/highlight.js"></script>
    <script src="https://unpkg.com/reveal.js/plugin/math/math.js"></script>
    <script src="https://unpkg.com/reveal.js/plugin/notes/notes.js"></script>

    <style>
/* ===== CSS RESET & C∆† B·∫¢N ===== */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    overflow-y: auto;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: #333;
}

/* ===== LOGIC ·∫®N/HI·ªÜN TRANG C·ªêT L√ïI ===== */
.page {
    display: none;
}

.page.active {
    display: block;
}

/* ===== TRANG CH·ªåN ƒê·ªÄ ===== */
#exam-selection-page {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 20px;
}

.exam-selection-container {
    max-width: 1200px;
    width: 100%;
    padding: 30px;
}

.exam-selection-title {
    text-align: center;
    color: white;
    margin-bottom: 40px;
    text-shadow: 0 2px 10px rgba(0,0,0,0.3);
}

.exam-selection-title h1 {
    font-size: 2.8em;
    margin-bottom: 10px;
}

.exam-selection-title p {
    font-size: 1.2em;
    opacity: 0.9;
}

.exam-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 25px;
    margin-bottom: 40px;
}

.exam-card {
    background: rgba(255,255,255,0.15);
    backdrop-filter: blur(10px);
    border-radius: 15px;
    padding: 25px;
    transition: all 0.3s ease;
    border: 1px solid rgba(255,255,255,0.1);
    cursor: pointer;
    position: relative;
    overflow: hidden;
}

.exam-card:hover {
    transform: translateY(-10px);
    background: rgba(255,255,255,0.25);
    box-shadow: 0 15px 35px rgba(0,0,0,0.2);
}

.exam-card.active {
    background: rgba(255,255,255,0.3);
    border: 2px solid #ffd54f;
    box-shadow: 0 0 30px rgba(255,213,79,0.3);
}

.exam-card h3 {
    color: white;
    margin: 0 0 15px 0;
    font-size: 1.5em;
    display: flex;
    align-items: center;
    gap: 10px;
}

.exam-card p {
    color: rgba(255,255,255,0.8);
    margin: 10px 0;
    line-height: 1.5;
}

.exam-meta {
    display: flex;
    justify-content: space-between;
    margin-top: 20px;
    font-size: 0.9em;
    color: rgba(255,255,255,0.7);
}

.exam-meta span {
    display: flex;
    align-items: center;
    gap: 5px;
}

.exam-actions {
    text-align: center;
    margin-top: 30px;
    padding-top: 30px;
    border-top: 1px solid rgba(255,255,255,0.2);
}

.btn-start-exam {
    display: inline-block;
    padding: 15px 40px;
    background: linear-gradient(135deg, #28a745, #20c997);
    color: white;
    text-decoration: none;
    border-radius: 12px;
    font-size: 1.1em;
    font-weight: 600;
    transition: all 0.3s ease;
    border: none;
    cursor: pointer;
}

.btn-start-exam:hover {
    background: linear-gradient(135deg, #20c997, #28a745);
    transform: scale(1.05);
    box-shadow: 0 10px 25px rgba(40,167,69,0.3);
}

.btn-start-exam:disabled {
    background: #6c757d;
    cursor: not-allowed;
    transform: none;
    box-shadow: none;
}

/* N√∫t quay l·∫°i trang ch·ªçn ƒë·ªÅ */
#back-to-selection {
    position: fixed;
    top: 85px;
    left: 20px;
    z-index: 10001;
    padding: 10px 20px;
    background: rgba(255,255,255,0.9);
    color: #1a237e;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 600;
    display: none;
}

#back-to-selection:hover {
    background: white;
    transform: translateY(-2px);
}

/* ===== TOPBAR ===== */
.topbar {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 70px;
    background: linear-gradient(135deg, #1a237e, #283593);
    color: white;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 25px;
    z-index: 10000;
    box-shadow: 0 4px 20px rgba(0,0,0,0.15);
    border-bottom: 3px solid #3949ab;
}

.topbar-title {
    font-size: 1.4rem;
    font-weight: bold;
    white-space: nowrap;
    display: flex;
    align-items: center;
    gap: 10px;
}

.topbar-title::before {
    content: "üßÆ";
    font-size: 1.6rem;
}

.topbar-controls {
    display: flex;
    align-items: center;
    gap: 12px;
}

.topbar-controls select,
.topbar-controls button {
    padding: 8px 16px;
    border: none;
    border-radius: 8px;
    background: rgba(255,255,255,0.15);
    color: white;
    cursor: pointer;
    transition: all 0.3s ease;
    font-weight: 500;
    border: 1px solid rgba(255,255,255,0.1);
}

.topbar-controls select:hover,
.topbar-controls button:hover {
    background: rgba(255,255,255,0.25);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
}

.topbar-controls select option {
    background: #283593;
    color: white;
}

/* ===== REVEAL.JS SLIDES ===== */
.reveal {
    height: calc(100vh - 70px);
    margin-top: 70px;
    background: white;
    border-radius: 20px 20px 0 0;
    box-shadow: 0 -5px 30px rgba(0,0,0,0.1);
}

.reveal .slides {
    text-align: left;
    font-size: 1.8rem;
    color: #2c3e50;
}

.reveal .slides section {
    padding: 30px 40px;
    height: 100%;
    overflow-y: auto;
    background: white;
}

.reveal h2 {
    color: #1a237e;
    margin-bottom: 25px;
    border-bottom: 3px solid #1a237e;
    padding-bottom: 15px;
    font-weight: 700;
}

.reveal h3 {
    color: #3949ab;
    margin: 20px 0 15px 0;
    font-weight: 600;
}

.reveal p, .reveal li {
    color: #34495e;
    line-height: 1.6;
    margin-bottom: 15px;
}

.reveal ul, .reveal ol {
    margin-left: 30px;
    margin-bottom: 20px;
}

/* ===== C√ÇU H·ªéI ===== */
.question {
    margin: 25px 0;
    padding: 20px;
    background: linear-gradient(135deg, #f8f9ff 0%, #f0f2ff 100%);
    border-radius: 15px;
    border-left: 6px solid #1a237e;
    color: #2c3e50;
    box-shadow: 0 4px 15px rgba(0,0,0,0.08);
    transition: transform 0.3s ease;
}

.question:hover {
    transform: translateY(-3px);
    box-shadow: 0 6px 20px rgba(0,0,0,0.12);
}

.question-title {
    margin-bottom: 20px;
    font-weight: 700;
    color: #1a237e;
    font-size: 1.1em;
    line-height: 1.5;
}

.option-row {
    margin: 12px 0;
    padding: 12px 15px;
    background: rgba(255,255,255,0.8);
    border-radius: 10px;
    color: #2c3e50;
    border: 2px solid transparent;
    transition: all 0.3s ease;
}

.option-row:hover {
    background: rgba(255,255,255,1);
    border-color: #1a237e;
    transform: translateX(5px);
}

.option-row label {
    margin-left: 10px;
    cursor: pointer;
    font-weight: 500;
}

.option-row input[type="radio"] {
    transform: scale(1.2);
    margin-right: 8px;
}

.answer-check {
    margin-top: 20px;
    display: flex;
    align-items: center;
    gap: 15px;
    flex-wrap: wrap;
}

.answer-check input {
    padding: 12px 15px;
    border: 2px solid #ddd;
    border-radius: 10px;
    background: white;
    color: #2c3e50;
    width: 250px;
    font-size: 1rem;
    transition: border-color 0.3s ease;
}

.answer-check input:focus {
    outline: none;
    border-color: #1a237e;
    box-shadow: 0 0 0 3px rgba(26, 35, 126, 0.1);
}

.answer-check button {
    padding: 12px 25px;
    background: linear-gradient(135deg, #1a237e, #3949ab);
    color: white;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    font-weight: 600;
    transition: all 0.3s ease;
}

.answer-check button:hover {
    background: linear-gradient(135deg, #3949ab, #1a237e);
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(26, 35, 126, 0.3);
}

/* ===== SLIDE MENU ===== */
.slide-menu {
    position: fixed;
    top: 0;
    left: -400px;
    width: 400px;
    height: 100vh;
    background: linear-gradient(135deg, #1a237e 0%, #283593 100%);
    z-index: 11000;
    transition: left 0.4s ease;
    box-shadow: 5px 0 25px rgba(0,0,0,0.3);
    color: white;
}

.slide-menu.active {
    left: 0;
}

.menu-header {
    padding: 25px;
    background: rgba(0,0,0,0.2);
    color: white;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 2px solid rgba(255,255,255,0.1);
}

.menu-header h3 {
    color: white;
    margin: 0;
    font-size: 1.4rem;
    display: flex;
    align-items: center;
    gap: 10px;
}

.close-btn {
    background: none;
    border: none;
    color: white;
    font-size: 2rem;
    cursor: pointer;
    padding: 5px;
    border-radius: 50%;
    transition: background 0.3s ease;
}

.close-btn:hover {
    background: rgba(255,255,255,0.1);
}

.menu-content {
    padding: 20px;
    height: calc(100% - 80px);
    overflow-y: auto;
}

.slide-item {
    padding: 15px 20px;
    margin-bottom: 10px;
    background: rgba(255,255,255,0.1);
    border-radius: 10px;
    cursor: pointer;
    transition: all 0.3s ease;
    color: white;
    border: 1px solid rgba(255,255,255,0.1);
}

.slide-item:hover {
    background: rgba(255,255,255,0.2);
    transform: translateX(10px);
}

.slide-item.active {
    background: rgba(255,255,255,0.25);
    border-left: 5px solid #ffd54f;
    font-weight: 600;
}

.slide-number {
    display: inline-block;
    width: 35px;
    height: 35px;
    text-align: center;
    line-height: 35px;
    margin-right: 15px;
    background: rgba(255,255,255,0.2);
    border-radius: 50%;
    font-weight: bold;
}

.menu-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.6);
    z-index: 10500;
    display: none;
    backdrop-filter: blur(5px);
}

.menu-overlay.active {
    display: block;
}

/* ===== CANVAS V·∫º ===== */
#drawCanvas {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 9000;
    display: none;
    pointer-events: none;
    background: transparent;
}

.toolbar {
    position: fixed;
    bottom: 30px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(0,0,0,0.9);
    padding: 15px 25px;
    border-radius: 15px;
    display: none;
    align-items: center;
    gap: 15px;
    z-index: 9100;
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255,255,255,0.1);
}

.toolbar select,
.toolbar input,
.toolbar button {
    padding: 8px 15px;
    border: none;
    border-radius: 8px;
    background: white;
    color: #333;
    cursor: pointer;
    font-weight: 500;
    transition: all 0.3s ease;
}

.toolbar select:hover,
.toolbar input:hover,
.toolbar button:hover {
    background: #f0f0f0;
    transform: translateY(-2px);
}

.toolbar input[type="color"] {
    padding: 4px;
    height: 40px;
    width: 60px;
}

.toolbar input[type="range"] {
    width: 100px;
}

/* ===== MODAL SYSTEM ===== */
.modal {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.7);
    z-index: 12000;
    align-items: center;
    justify-content: center;
    backdrop-filter: blur(10px);
}

.modal.active {
    display: flex;
}

.modal-content {
    background: white;
    color: #333;
    padding: 30px;
    border-radius: 20px;
    width: 90%;
    max-width: 500px;
    box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    border: 1px solid rgba(255,255,255,0.2);
    animation: modalAppear 0.4s ease;
    position: relative;
    max-height: 90vh;
    overflow-y: auto;
}

.modal-content-scrollable {
    max-width: 900px;
    display: flex;
    flex-direction: column;
    max-height: 85vh;
    overflow-y: hidden;
}

.modal-content-scrollable .table-container {
    flex: 1;
    min-height: 150px;
}

.modal-close {
    position: absolute;
    top: 15px;
    right: 15px;
    background: none;
    border: none;
    font-size: 1.5rem;
    cursor: pointer;
    color: #666;
    width: 35px;
    height: 35px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
}

.modal-close:hover {
    background: #f0f0f0;
    color: #333;
}

@keyframes modalAppear {
    from {
        opacity: 0;
        transform: scale(0.8) translateY(-50px);
    }
    to {
        opacity: 1;
        transform: scale(1) translateY(0);
    }
}

.modal-content h3 {
    color: #1a237e;
    margin-bottom: 20px;
    text-align: center;
    font-size: 1.5rem;
    padding-right: 30px;
}

.modal-content input {
    width: 100%;
    padding: 15px;
    margin: 10px 0;
    border: 2px solid #e0e0e0;
    border-radius: 10px;
    font-size: 1rem;
    transition: border-color 0.3s ease;
}

.modal-content input:focus {
    outline: none;
    border-color: #1a237e;
}

.modal-content button {
    padding: 12px 25px;
    margin: 5px;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    font-weight: 600;
    transition: all 0.3s ease;
}

.modal-content button[type="submit"] {
    background: linear-gradient(135deg, #1a237e, #3949ab);
    color: white;
}

.modal-content button[type="submit"]:hover {
    background: linear-gradient(135deg, #3949ab, #1a237e);
    transform: translateY(-2px);
}

/* ===== FIREBASE STATUS ===== */
.firebase-status {
    position: fixed;
    top: 75px;
    right: 15px;
    padding: 8px 15px;
    border-radius: 20px;
    font-size: 0.85rem;
    z-index: 10001;
    font-weight: 600;
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255,255,255,0.2);
}

.firebase-connected {
    background: rgba(40, 167, 69, 0.9);
    color: white;
}

.firebase-disconnected {
    background: rgba(220, 53, 69, 0.9);
    color: white;
}

/* ===== DARK MODE ===== */
.dark-mode body {
    background: #121212 !important;
    color: #fff !important;
}

.dark-mode .reveal,
.dark-mode .reveal .slides section {
    background: #1e1e1e !important;
    color: #fff !important;
}

.dark-mode .reveal h1,
.dark-mode .reveal h2,
.dark-mode .reveal h3,
.dark-mode .reveal p,
.dark-mode .reveal li,
.dark-mode .reveal strong {
    color: #fff !important;
}

.dark-mode .question {
    background: rgba(40, 40, 40, 0.9) !important;
    color: #fff !important;
    border-left: 6px solid #00bcd4 !important;
}

.dark-mode .solution-box {
    background: rgba(50, 50, 50, 0.9) !important;
    color: #e0e0e0 !important;
    border-left: 6px solid #4caf50 !important;
}

.dark-mode .option-row {
    background: rgba(60, 60, 60, 0.9) !important;
    color: #fff !important;
    border: 1px solid #555 !important;
}

.dark-mode .option-row:hover {
    background: rgba(80,80,80,1) !important;
}

.dark-mode .topbar {
    background: linear-gradient(135deg, #000, #222) !important;
}

.dark-mode .topbar-controls button {
    background: rgba(255,255,255,0.1) !important;
    color: #fff !important;
}

.dark-mode .slide-menu {
    background: #222 !important;
}

/* ===== RESPONSIVE ===== */
@media (max-width: 768px) {
    .topbar {
        padding: 0 10px;
        height: auto;
        flex-direction: column;
        gap: 10px;
        padding: 10px;
    }
    
    .topbar-title {
        font-size: 1.1rem;
    }
    
    .topbar-controls {
        gap: 5px;
        flex-wrap: wrap;
        justify-content: center;
    }
    
    .topbar-controls button, 
    .topbar-controls select {
        padding: 6px 10px;
        font-size: 0.85rem;
    }
    
    .reveal {
        margin-top: 110px;
        height: calc(100vh - 110px);
    }
    
    .slide-menu { 
        width: 300px; 
        left: -300px; 
    }
    
    .reveal .slides { 
        font-size: 1.5rem; 
    }
    
    .reveal .slides section { 
        padding: 20px; 
    }
    
    .modal-content {
        padding: 20px;
        width: 95%;
    }
    
    .modal-content-scrollable {
        max-width: 95%;
    }
    
    .exam-selection-title h1 {
        font-size: 2em;
    }
    
    .exam-grid {
        grid-template-columns: 1fr;
    }
    
    #back-to-selection {
        top: 120px;
        left: 10px;
        padding: 8px 15px;
        font-size: 0.9rem;
    }
}

/* ===== TH√äM M·ªòT S·ªê STYLE QUAN TR·ªåNG ===== */
.option-icon {
    margin-left: 10px;
    font-weight: bold;
    font-size: 1.1em;
    min-width: 20px;
    display: inline-block;
}

.solution-box {
    background: linear-gradient(135deg, #e3f2fd, #bbdefb);
    border-left: 6px solid #1976d2;
    padding: 20px;
    margin: 20px 0;
    border-radius: 10px;
    box-shadow: 0 4px 15px rgba(25, 118, 210, 0.1);
}

.solution-title {
    color: #1976d2;
    font-weight: 700;
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    gap: 10px;
}

.solution-title::before {
    content: "üí°";
    font-size: 1.2em;
}

.solution-content {
    color: #1565c0;
    line-height: 1.6;
}

.notification {
    position: fixed;
    top: 80px;
    right: 20px;
    padding: 15px 25px;
    border-radius: 10px;
    color: white;
    font-weight: 600;
    z-index: 100000;
    box-shadow: 0 5px 20px rgba(0,0,0,0.2);
    transform: translateX(400px);
    transition: transform 0.4s ease;
}

.notification.show {
    transform: translateX(0);
}

.notification.success {
    background: linear-gradient(135deg, #28a745, #20c997);
}

.notification.error {
    background: linear-gradient(135deg, #dc3545, #c82333);
}

.notification.warning {
    background: linear-gradient(135deg, #ffc107, #e0a800);
    color: #000;
}

.notification.info {
    background: linear-gradient(135deg, #17a2b8, #138496);
}

/* Teacher controls */
#teacher-controls {
    display: none;
    position: fixed;
    top: 80px;
    right: 30px;
    z-index: 22000;
    gap: 10px;
    flex-direction: column;
    background: rgba(255,255,255,0.95);
    padding: 20px;
    border-radius: 15px;
    box-shadow: 0 10px 40px rgba(0,0,0,0.2);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255,255,255,0.2);
}

#teacher-controls button {
    padding: 12px 20px;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    font-size: 0.95rem;
    font-weight: 600;
    transition: all 0.3s ease;
}

#create-session-btn {
    background: linear-gradient(135deg, #17a2b8, #138496);
    color: #fff;
}

#start-poll-btn {
    background: linear-gradient(135deg, #ffc107, #e0a800);
    color: #000;
}

#view-poll-results-btn {
    background: linear-gradient(135deg, #6f42c1, #5a2d91);
    color: #fff;
}

#teacher-controls button:hover {
    transform: translateY(-3px);
    box-shadow: 0 6px 20px rgba(0,0,0,0.2);
}

/* N√∫t t∆∞∆°ng t√°c h·ªçc sinh */
#studentInteractBtn {
    display: none;
}

#teacherMonitorBtn {
    display: none;
}
</style>
</head>
<body>
    <!-- ===== TRANG CH·ªåN ƒê·ªÄ ===== -->
    <div id="exam-selection-page" class="page active">
        <div class="exam-selection-container">
            <div class="exam-selection-title">
                <h1>üßÆ L·ªöP TO√ÅN TH·∫¶Y B√åNH</h1>
                <p>H·ªá th·ªëng ƒë·ªÅ thi tr·ª±c tuy·∫øn - Ch·ªçn ƒë·ªÅ ƒë·ªÉ b·∫Øt ƒë·∫ßu l√†m b√†i</p>
            </div>

            <div class="exam-grid" id="exam-grid">
                <!-- Danh s√°ch ƒë·ªÅ s·∫Ω ƒë∆∞·ª£c t·∫£i ƒë·ªông -->
                <div class="exam-card" style="text-align: center; padding: 40px;">
                    <div style="font-size: 3em; margin-bottom: 20px;">üìä</div>
                    <p>ƒêang t·∫£i danh s√°ch ƒë·ªÅ thi...</p>
                </div>
            </div>

            <div class="exam-actions">
                <button id="start-exam-btn" class="btn-start-exam" disabled onclick="startExam()">
    üöÄ B·∫Øt ƒë·∫ßu l√†m b√†i
</button>
                <p style="color: rgba(255,255,255,0.7); margin-top: 15px; font-size: 0.9em;">
                    Ch·ªçn m·ªôt ƒë·ªÅ thi t·ª´ danh s√°ch tr√™n ƒë·ªÉ b·∫Øt ƒë·∫ßu
                </p>
            </div>
        </div>
    </div>

    <!-- ===== TRANG L√ÄM B√ÄI ===== -->
    <div id="exam-page" class="page">
        <!-- Thanh ti√™u ƒë·ªÅ -->
        <div class="topbar">
            <div class="topbar-title" id="current-exam-title">L·ªöP TO√ÅN TH·∫¶Y B√åNH</div>
          
            <div class="topbar-controls">
                <button id="slideMenuBtn">üìã DS Slide</button>
                <select id="selectExam">
                    <option value="mm">-- Ch·ªçn ƒë·ªÅ --</option>
                    <!-- C√°c ƒë·ªÅ s·∫Ω ƒë∆∞·ª£c th√™m ƒë·ªông -->
                </select>
                <button id="studentInteractBtn">üéÆ T∆∞∆°ng t√°c</button>
                <button id="teacherMonitorBtn">üëÅÔ∏è Theo d√µi</button>
                <button id="loginBtn">üîë ƒêƒÉng nh·∫≠p</button>
                <button id="scoreBtn">üìä T√≠nh ƒëi·ªÉm</button>
                <button id="toggleMenu">‚úèÔ∏è B·∫£ng v·∫Ω</button>
                <button id="classManagementBtn">üè´ Qu·∫£n l√Ω L·ªõp</button>
                <button id="toggleStyleBtn">üåô Ch·∫ø ƒë·ªô t·ªëi</button>
                <button id="fullscreenBtn">üì∫ Fullscreen</button>
            </div>
        </div>

        <button id="back-to-selection">‚Üê V·ªÅ trang ch·ªçn ƒë·ªÅ</button>

        <!-- Firebase Status -->
        <div id="firebaseStatus" class="firebase-status firebase-disconnected">
            <span class="loading-spinner"></span> ƒêang k·∫øt n·ªëi...
        </div>

        <!-- Notification -->
        <div id="notification" class="notification"></div>

        <!-- Reveal.js Container -->
        <div class="reveal">
            <div class="slides">
                <!-- C√¢u h·ªèi s·∫Ω ƒë∆∞·ª£c t·∫£i ƒë·ªông -->
                <section id="questions-container"></section>
            </div>
        </div>
    </div>

    <!-- === COPY TO√ÄN B·ªò C√ÅC MODAL T·ª™ FILE C≈® V√ÄO ƒê√ÇY === -->
    <!-- Slide Menu, Canvas, Modal System, Teacher Monitor, Class Management... -->
    <!-- ... -->
     <!-- === HTML T√çCH H·ª¢P: SLIDE MENU === -->
<div class="slide-menu" id="slideMenu">
    <div class="menu-header">
        <h3>üìã Danh s√°ch slide</h3>
        <button class="close-btn" id="closeSlideMenu">√ó</button>
    </div>
    <div class="menu-content">
        <div class="slide-list" id="slideList">
            <!-- T·ª± ƒë·ªông t·∫°o b·∫±ng JavaScript -->
        </div>
    </div>
</div>
<div class="menu-overlay" id="menuOverlay"></div>

<!-- === HTML T√çCH H·ª¢P: CANVAS V·∫º === -->
<canvas id="drawCanvas"></canvas>
<div class="toolbar" id="drawToolbar">
    <a href="index.html" title="V·ªÅ trang ch·ªß (demo)">
      <button id="homeBtn" style="font-size:22px;">üè†</button>
    </a>
    <select id="tool">
        <option value="pen">‚úèÔ∏è B√∫t</option>
        <option value="line">üìè ƒê∆∞·ªùng</option>
        <option value="rect">‚¨õ Ch·ªØ nh·∫≠t</option>
        <option value="parallelogram">‚ñ± B√¨nh h√†nh</option>
        <option value="circle">‚ö™ Tr√≤n</option>
        <option value="dashedLineBtn">‚Äì ‚Äì</option>
        <option value="ellipseBtn">‚¨≠ Elip</option>
        <option value="box">üì¶ H·ªôp 3D</option>
        <option value="pyramid3">üî∫ Ch√≥p tam gi√°c</option>
        <option value="pyramid4">üî≤ Ch√≥p t·ª© gi√°c</option>
        <option value="sphere">‚öΩ C·∫ßu</option>
    </select>
    <input id="draw-width" max="10" min="1" type="range" value="2"/>
    <input id="colorPicker" type="color" value="#6b21a8">
    <button id="undoBtn" title="Undo">‚Ü©Ô∏è</button>
    <button id="clearBtn">üßπ Xo√°</button>
    <button id="saveBtn">üíæ L∆∞u</button>
    <button id="exitBtn">‚ùå Tho√°t</button>
</div>

<!-- === MODAL SYSTEM C·∫¢I TI·∫æN === -->
<!-- Modal Qu·∫£n l√Ω L·ªõp v√† H·ªçc sinh -->
<div class="modal" id="class-management-modal">
    <div class="modal-content modal-content-scrollable">
        <button class="modal-close" id="close-class-management">√ó</button>
        <h3>üè´ Qu·∫£n l√Ω L·ªõp v√† H·ªçc sinh</h3>
        
        <div style="display: flex; gap: 20px; margin-bottom: 25px;">
            <button id="create-class-btn" style="flex: 1; padding: 12px; background: linear-gradient(135deg, #28a745, #20c997); color: white; border: none; border-radius: 10px; font-weight: 600;">
                ‚ûï T·∫°o L·ªõp M·ªõi
            </button>
            <button id="assign-student-btn-main" style="flex: 1; padding: 12px; background: linear-gradient(135deg, #17a2b8, #138496); color: white; border: none; border-radius: 10px; font-weight: 600;">
                üéì C·∫•p M√£ HS
            </button>
            <button id="view-student-codes-btn" style="flex: 1; padding: 12px; background: linear-gradient(135deg, #6f42c1, #5a2d91); color: white; border: none; border-radius: 10px; font-weight: 600;">
                üìã DS M√£ HS
            </button>
            <button id="refresh-classes-btn" style="flex: 1; padding: 12px; background: linear-gradient(135deg, #ffc107, #e0a800); color: #000; border: none; border-radius: 10px; font-weight: 600;">
                üîÑ L√†m m·ªõi
            </button>
            <button id="class-poll-btn" style="flex: 1; padding: 12px; background: linear-gradient(135deg, #ffc107, #e0a800); color: #000; border: none; border-radius: 10px; font-weight: 600;">
                üó≥Ô∏è Poll L·ªõp
            </button>
            <button id="class-sync-btn" style="flex: 1; padding: 12px; background: linear-gradient(135deg, #6f42c1, #5a2d91); color: white; border: none; border-radius: 10px; font-weight: 600;">
                üîÑ ƒê·ªìng b·ªô Slide
            </button>
            <button id="view-poll-results-btn" style="flex: 1; padding: 12px; background: linear-gradient(135deg, #17a2b8, #138496); color: white; border: none; border-radius: 10px; font-weight: 600;">
                üìä Xem K·∫øt qu·∫£ Poll
            </button>
            <button id="view-interactions-btn" style="flex: 1; padding: 12px; background: linear-gradient(135deg, #fd7e14, #e55a00); color: white; border: none; border-radius: 10px; font-weight: 600;">
                üí¨ Xem T∆∞∆°ng t√°c
            </button>
        </div>

        <!-- Danh s√°ch l·ªõp -->
        <div style="margin-bottom: 25px;">
            <h4 style="color: #1a237e; margin-bottom: 15px;">üìö Danh s√°ch L·ªõp h·ªçc</h4>
            <div class="table-container" style="max-height: 300px;">
                <table>
                    <thead>
                        <tr>
                            <th>T√™n L·ªõp</th>
                            <th>M√£ L·ªõp</th>
                            <th>S·ªë HS</th>
                            <th>Ng√†y t·∫°o</th>
                            <th>Tr·∫°ng th√°i</th>
                            <th>Thao t√°c</th>
                        </tr>
                    </thead>
                    <tbody id="classes-list-body">
                        <tr>
                            <td colspan="6" style="text-align: center; padding: 20px; color: #666;">
                                ƒêang t·∫£i danh s√°ch l·ªõp...
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Danh s√°ch h·ªçc sinh -->
        <div>
            <h4 style="color: #1a237e; margin-bottom: 15px;">üë• Danh s√°ch H·ªçc sinh</h4>
            <div style="display: flex; gap: 15px; margin-bottom: 15px;">
                <input type="text" id="search-student-global" placeholder="üîç T√¨m h·ªçc sinh..." style="flex: 1; padding: 10px; border: 2px solid #ddd; border-radius: 8px;">
                <select id="filter-class" style="padding: 10px; border: 2px solid #ddd; border-radius: 8px;">
                    <option value="all">T·∫•t c·∫£ l·ªõp</option>
                </select>
            </div>
            <div class="table-container" style="max-height: 400px;">
                <table>
                    <thead>
                        <tr>
                            <th>M√£ HS</th>
                            <th>H·ªç t√™n</th>
                            <th>L·ªõp</th>
                            <th>L·∫ßn cu·ªëi ho·∫°t ƒë·ªông</th>
                            <th>T·ªïng b√†i l√†m</th>
                            <th>ƒêi·ªÉm TB</th>
                            <th>Thao t√°c</th>
                        </tr>
                    </thead>
                    <tbody id="students-list-body">
                        <tr>
                            <td colspan="7" style="text-align: center; padding: 20px; color: #666;">
                                ƒêang t·∫£i danh s√°ch h·ªçc sinh...
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- Modal t·∫°o l·ªõp m·ªõi -->
<div class="modal" id="create-class-modal">
    <div class="modal-content" style="max-width: 500px;">
        <button class="modal-close" id="cancel-create-class">√ó</button>
        <h3>üè´ T·∫°o L·ªõp M·ªõi</h3>
        <form id="create-class-form">
            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 600;">T√™n l·ªõp:</label>
                <input type="text" id="class-name" placeholder="V√≠ d·ª•: 12A1, To√°n N√¢ng cao..." required style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px;">
            </div>
            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 600;">M√¥ t·∫£:</label>
                <textarea id="class-description" placeholder="M√¥ t·∫£ v·ªÅ l·ªõp h·ªçc..." style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; height: 80px;"></textarea>
            </div>
            <div style="display: flex; gap: 10px; justify-content: flex-end;">
                <button type="submit" style="padding: 12px 25px; background: linear-gradient(135deg, #28a745, #20c997); color: white; border: none; border-radius: 8px; font-weight: 600;">
                    üè´ T·∫°o L·ªõp
                </button>
                <button type="button" id="cancel-create-class-btn" style="padding: 12px 25px; background: #6c757d; color: white; border: none; border-radius: 8px;">H·ªßy</button>
            </div>
        </form>
    </div>
</div>

<!-- Modal c·∫•p m√£ h·ªçc sinh -->
<div class="modal" id="assign-student-modal">
    <div class="modal-content" style="max-width: 600px;">
        <button class="modal-close" id="cancel-assign-student">√ó</button>
        <h3>üéì C·∫•p M√£ H·ªçc Sinh</h3>
        
        <div style="margin-bottom: 20px;">
            <label style="display: block; margin-bottom: 8px; font-weight: 600;">Ch·ªçn l·ªõp:</label>
            <select id="select-class-for-student" style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px;">
                <option value="">-- Ch·ªçn l·ªõp --</option>
            </select>
        </div>

        <div style="margin-bottom: 20px;">
            <label style="display: block; margin-bottom: 8px; font-weight: 600;">Th√¥ng tin h·ªçc sinh:</label>
            <input type="text" id="student-fullname" placeholder="H·ªç v√† t√™n h·ªçc sinh" style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; margin-bottom: 10px;">
            <input type="email" id="student-email" placeholder="Email (tu·ª≥ ch·ªçn)" style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px;">
        </div>

        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
            <h4 style="margin: 0 0 10px 0; color: #1a237e;">M√£ h·ªçc sinh s·∫Ω ƒë∆∞·ª£c t·∫°o:</h4>
            <div id="generated-student-code" style="font-family: monospace; font-size: 1.2em; font-weight: bold; color: #1a237e; background: white; padding: 10px; border-radius: 6px; text-align: center;">
                HS_XXXXXX
            </div>
        </div>

        <div style="display: flex; gap: 10px; justify-content: flex-end;">
            <button id="generate-student-code-btn" style="padding: 12px 25px; background: linear-gradient(135deg, #17a2b8, #138496); color: white; border: none; border-radius: 8px; font-weight: 600;">
                üé≤ T·∫°o M√£
            </button>
            <button id="assign-student-btn" style="padding: 12px 25px; background: linear-gradient(135deg, #28a745, #20c997); color: white; border: none; border-radius: 8px; font-weight: 600;">
                ‚úÖ C·∫•p M√£
            </button>
        </div>
    </div>
</div>

<!-- Modal danh s√°ch m√£ h·ªçc sinh -->
<div class="modal" id="student-codes-modal">
    <div class="modal-content" style="max-width: 800px;">
        <button class="modal-close" id="close-student-codes">√ó</button>
        <h3>üìã Danh s√°ch M√£ H·ªçc Sinh</h3>
        
        <div style="display: flex; gap: 15px; margin-bottom: 20px;">
            <select id="filter-class-codes" style="flex: 1; padding: 10px; border: 2px solid #ddd; border-radius: 8px;">
                <option value="all">T·∫•t c·∫£ l·ªõp</option>
            </select>
            <button id="export-codes-btn" style="padding: 10px 20px; background: linear-gradient(135deg, #6f42c1, #5a2d91); color: white; border: none; border-radius: 8px; font-weight: 600;">
                üì§ Xu·∫•t Excel
            </button>
        </div>

        <div class="table-container" style="max-height: 500px;">
            <table>
                <thead>
                    <tr>
                        <th>M√£ HS</th>
                        <th>H·ªç t√™n</th>
                        <th>L·ªõp</th>
                        <th>Ng√†y c·∫•p</th>
                        <th>Tr·∫°ng th√°i</th>
                        <th>M·∫≠t kh·∫©u</th>
                        <th>Thao t√°c</th>
                    </tr>
                </thead>
                <tbody id="student-codes-list">
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 30px; color: #666;">
                            ƒêang t·∫£i danh s√°ch m√£ h·ªçc sinh...
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Confirm Delete Modal -->
<div class="confirm-modal" id="confirm-delete-modal">
    <div class="confirm-content">
        <h3>‚ö†Ô∏è X√°c nh·∫≠n X√≥a</h3>
        <p id="confirm-delete-message">B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a?</p>
        <div class="confirm-buttons">
            <button class="confirm-yes" id="confirm-delete-yes">X√≥a</button>
            <button class="confirm-no" id="confirm-delete-no">H·ªßy</button>
        </div>
    </div>
</div>

<!-- LOGIN MODAL -->
<div class="modal" id="login-modal">
    <div class="modal-content">
        <button class="modal-close" id="close-modal">√ó</button>
        <h3>üîê ƒêƒÉng nh·∫≠p h·ªá th·ªëng</h3>
        <form id="code-login-form">
            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 5px; font-weight: 600;">M√£ ƒëƒÉng nh·∫≠p:</label>
                <input id="login-code" placeholder="Nh·∫≠p m√£ h·ªçc sinh/gi√°o vi√™n" required type="text"/>
            </div>
            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 5px; font-weight: 600;">H·ªç t√™n:</label>
                <input id="student-name" placeholder="Nh·∫≠p h·ªç t√™n c·ªßa b·∫°n" type="text"/>
            </div>
            <div style="display:flex;gap:10px;justify-content:flex-end;margin-top:20px;">
                <button type="submit" style="flex: 1;">üöÄ ƒêƒÉng nh·∫≠p</button>
            </div>
        </form>
        <div id="auth-status" style="margin-top: 15px;"></div>
        <div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 10px;">
            <p style="margin: 0; font-size: 0.9em; color: #666;">
                <strong>H∆∞·ªõng d·∫´n:</strong><br>
                ‚Ä¢ Gi√°o vi√™n: c·∫•p m√£ g·ªìm m√£ v√† h·ªç t√™n<br>
                ‚Ä¢ H·ªçc sinh nh·∫≠p ch√≠nh x√°c c·∫£ 2 <br>
            </p>
        </div>
    </div>
</div>

<!-- B·∫£ng theo d√µi h·ªçc sinh real-time -->
<div id="teacher-monitor">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
        <h3 style="margin: 0; color: #1a237e;">üìä B·∫£ng theo d√µi h·ªçc sinh - REAL TIME</h3>
        <div>
            <button id="monitor-create-session" style="background: #17a2b8; color: white; border: none; padding: 8px 15px; border-radius: 5px; margin-right: 10px;">
                üÜî T·∫°o l·ªõp
            </button>
            <button id="monitor-start-poll" style="background: #ffc107; color: black; border: none; padding: 8px 15px; border-radius: 5px; margin-right: 10px;">
                üó≥Ô∏è Poll
            </button>
            <button id="monitor-sync-slides" style="background: #6f42c1; color: white; border: none; padding: 8px 15px; border-radius: 5px; margin-right: 10px;">
                üîÑ ƒê·ªìng b·ªô
            </button>
            <button id="closeMonitor" style="background: #ff4757; color: white; border: none; padding: 10px 20px; border-radius: 8px; font-weight: 600;">
                ‚úï ƒê√≥ng
            </button>
        </div>
    </div>
    
    <div style="margin-bottom: 20px; display: flex; gap: 30px; align-items: center;">
        <div>
            <strong>M√£ l·ªõp:</strong> <code id="monitor-session-code" style="background: #1a237e; color: white; padding: 5px 10px; border-radius: 5px;">Ch∆∞a c√≥</code>
        </div>
        <div>
            <strong>H·ªçc sinh online:</strong> <span id="live-student-count" style="font-size: 1.2em; font-weight: bold; color: #1a237e;">0</span>
        </div>
    </div>

    <!-- B·ªô l·ªçc v√† t√¨m ki·∫øm -->
    <div style="display: flex; gap: 15px; margin-bottom: 20px;">
        <input type="text" id="search-student" placeholder="üîç T√¨m theo t√™n h·ªçc sinh..." style="padding: 12px; border: 2px solid #ddd; border-radius: 10px; flex: 1; font-size: 1rem;">
        <select id="filter-status" style="padding: 12px; border: 2px solid #ddd; border-radius: 10px; font-size: 1rem;">
            <option value="all">T·∫•t c·∫£ tr·∫°ng th√°i</option>
            <option value="active">ƒêang l√†m b√†i</option>
            <option value="finished">ƒê√£ ho√†n th√†nh</option>
            <option value="not-started">Ch∆∞a b·∫Øt ƒë·∫ßu</option>
        </select>
    </div>

    <!-- B·∫£ng k·∫øt qu·∫£ -->
    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th style="text-align: left;">H·ªçc sinh</th>
                    <th style="text-align: center;">Tr·∫°ng th√°i</th>
                    <th style="text-align: center;">ƒêi·ªÉm s·ªë</th>
                    <th style="text-align: center;">Th·ªùi gian l√†m</th>
                    <th style="text-align: center;">Ti·∫øn ƒë·ªô</th>
                    <th style="text-align: center;">Chi ti·∫øt</th>
                </tr>
            </thead>
            <tbody id="student-results-body">
                <tr>
                    <td colspan="6" style="text-align: center; padding: 30px; color: #666;">
                        <div style="font-size: 1.2em; margin-bottom: 10px;">üìä</div>
                        Ch∆∞a c√≥ h·ªçc sinh n√†o tham gia l·ªõp h·ªçc
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- Th·ªëng k√™ t·ªïng quan -->
    <div style="margin-top: 30px; padding: 25px; background: linear-gradient(135deg, #f8f9ff 0%, #f0f2ff 100%); border-radius: 15px; border: 2px solid #e0e0e0;">
        <h4 style="margin-top: 0; color: #1a237e; margin-bottom: 20px;">üìà Th·ªëng k√™ t·ªïng quan l·ªõp h·ªçc</h4>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 20px;">
            <div style="text-align: center; padding: 20px; background: white; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                <div style="font-size: 2em; font-weight: bold; color: #17a2b8;" id="stats-total">0</div>
                <div style="font-size: 0.9em; color: #6c757d; font-weight: 600;">T·ªïng s·ªë HS</div>
            </div>
            <div style="text-align: center; padding: 20px; background: white; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                <div style="font-size: 2em; font-weight: bold; color: #28a745;" id="stats-completed">0</div>
                <div style="font-size: 0.9em; color: #6c757d; font-weight: 600;">ƒê√£ ho√†n th√†nh</div>
            </div>
            <div style="text-align: center; padding: 20px; background: white; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                <div style="font-size: 2em; font-weight: bold; color: #ffc107;" id="stats-average">0.0</div>
                <div style="font-size: 0.9em; color: #6c757d; font-weight: 600;">ƒêi·ªÉm TB</div>
            </div>
            <div style="text-align: center; padding: 20px; background: white; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                <div style="font-size: 2em; font-weight: bold; color: #dc3545;" id="stats-failed">0</div>
                <div style="font-size: 0.9em; color: #6c757d; font-weight: 600;">D∆∞·ªõi 5 ƒëi·ªÉm</div>
            </div>
        </div>
    </div>

    <!-- V√πng hi·ªÉn th·ªã k·∫øt qu·∫£ poll -->
    <div id="poll-results-area" style="display: none; margin-top: 30px; padding: 20px; background: #f8f9fa; border-radius: 10px;">
        <h4 id="poll-results-title" style="color: #1a237e; margin-bottom: 15px;">üìä K·∫øt qu·∫£ kh·∫£o s√°t</h4>
        <canvas id="pollChartInMonitor" width="700" height="300"></canvas>
        <div id="poll-stats-in-monitor" style="margin-top: 15px;"></div>
    </div>
</div>

<!-- Poll modal (hi·ªán cho HS khi c√≥ poll) -->
<div class="modal" id="poll-modal">
  <div class="modal-content">
    <button class="modal-close" id="poll-close-btn">√ó</button>
    <h3 id="poll-title">üó≥Ô∏è Kh·∫£o s√°t nhanh</h3>
    <div id="poll-options"></div>
    <div style="margin-top:20px; display:flex; justify-content:space-between;">
      <button id="poll-submit-btn" style="background:linear-gradient(135deg, #28a745, #20c997); color:#fff; font-weight: 600;">‚úÖ G·ª≠i ph·∫£n h·ªìi</button>
    </div>
  </div>
</div>






    <!--@@@ ===== SCRIPT CH√çNH ===== -->
    <script>
        // ===== BI·∫æN TO√ÄN C·ª§C =====
        let currentExam = null;
        let currentQuestions = [];
        let examList = [];
        let db = null;
        let auth = null;
        let currentUser = null;
        let isTeacherLoggedIn = false;
        let sessionCode = '';
        let revealInitialized = false;

        // ===== DANH S√ÅCH ƒê·ªÄ THI =====
        const DEFAULT_EXAMS = [
            {
                id: 'gk1de1',
                name: 'ƒê·ªÅ 1: Gi·ªØa HK1',
                file: 'gk1de1.json',
                description: 'ƒê·ªÅ ki·ªÉm tra gi·ªØa k·ª≥ 1 - To√°n l·ªõp 12',
                time: 90,
                questions: 2,
                color: '#667eea',
                category: 'Gi·ªØa k·ª≥',
                created: '2024-01-15'
            },
            {
                id: 'test',
                name: 'ƒê·ªÅ Test Nhanh',
                file: 'test.json',
                description: 'ƒê·ªÅ test h·ªá th·ªëng',
                time: 15,
                questions: 3,
                color: '#28a745',
                category: 'Test',
                created: '2024-01-01'
            }
        ];

        // ===== KH·ªûI T·∫†O ·ª®NG D·ª§NG =====
                // ===== KH·ªûI T·∫†O ·ª®NG D·ª§NG =====
        document.addEventListener('DOMContentLoaded', function() {
            console.log("üöÄ H·ªá th·ªëng L·ªõp To√°n Th·∫ßy B√¨nh ƒëang kh·ªüi ch·∫°y...");
            
            initializeFirebase();
            loadExamList();
            
            // G√ÅN S·ª∞ KI·ªÜN TO√ÄN C·ª§C NGAY T·ª™ ƒê·∫¶U
            setupGlobalEventListeners();
            
            // S·ª± ki·ªán cho n√∫t quay l·∫°i trang ch·ªçn ƒë·ªÅ
            document.getElementById('back-to-selection').addEventListener('click', switchToSelectionPage);
            
            console.log("‚úÖ ƒê√£ kh·ªüi t·∫°o xong trang ch·ªçn ƒë·ªÅ v√† c√°c ch·ª©c nƒÉng to√†n c·ª•c.");
        });

        // ===== FIREBASE =====
        function initializeFirebase() {
            try {
                const firebaseConfig = {
                    apiKey: "AIzaSyDVRsgVDCKk5lIfCRxhSlWiBetNlZBukcc",
                    authDomain: "daytoantructuyen-149d9.firebaseapp.com",
                    databaseURL: "https://daytoantructuyen-149d9-default-rtdb.asia-southeast1.firebasedatabase.app",
                    projectId: "daytoantructuyen-149d9",
                    storageBucket: "daytoantructuyen-149d9.firebasestorage.app",
                    messagingSenderId: "258454714393",
                    appId: "1:258454714393:web:bcf66624668e516934d288"
                };

                firebase.initializeApp(firebaseConfig);
                db = firebase.database();
                auth = firebase.auth();

                // Theo d√µi tr·∫°ng th√°i k·∫øt n·ªëi
                db.ref('.info/connected').on('value', snap => {
                    const statusElement = document.getElementById('firebaseStatus');
                    if (snap.val() === true) {
                        statusElement.innerHTML = "‚úÖ Firebase: ƒê√£ k·∫øt n·ªëi";
                        statusElement.className = "firebase-status firebase-connected";
                    } else {
                        statusElement.innerHTML = '<span class="loading-spinner"></span> Firebase: ƒêang k·∫øt n·ªëi...';
                        statusElement.className = "firebase-status firebase-disconnected";
                    }
                });

                console.log("‚úÖ Firebase initialized");
            } catch (error) {
                console.error("‚ùå Firebase initialization failed:", error);
                showNotification('L·ªói kh·ªüi t·∫°o Firebase', 'error');
            }
        }

                // ===== G√ÅN S·ª∞ KI·ªÜN TO√ÄN C·ª§C =====
        function setupGlobalEventListeners() {
            console.log("üîß ƒêang g√°n c√°c s·ª± ki·ªán to√†n c·ª•c...");

            // N√∫t ƒëƒÉng nh·∫≠p
            const loginBtn = document.getElementById('loginBtn');
            if (loginBtn) {
                loginBtn.addEventListener('click', showLoginModal);
            }

            // N√∫t dark mode
            const styleBtn = document.getElementById('toggleStyleBtn');
            if (styleBtn) {
                styleBtn.addEventListener('click', function() {
                    document.documentElement.classList.toggle('dark-mode');
                    this.textContent = document.documentElement.classList.contains('dark-mode') 
                        ? '‚òÄÔ∏è Ch·∫ø ƒë·ªô s√°ng' 
                        : 'üåô Ch·∫ø ƒë·ªô t·ªëi';
                    if (window.MathJax) {
                        MathJax.typesetPromise();
                    }
                });
            }

            // N√∫t Fullscreen
            const fullscreenBtn = document.getElementById('fullscreenBtn');
            if (fullscreenBtn) {
                fullscreenBtn.addEventListener('click', function() {
                    if (!document.fullscreenElement) {
                        document.documentElement.requestFullscreen();
                        this.textContent = 'üì∫ Exit';
                    } else {
                        document.exitFullscreen();
                        this.textContent = 'üì∫ Fullscreen';
                    }
                });
            }

            // N√∫t Qu·∫£n l√Ω L·ªõp
            const classManagementBtn = document.getElementById('classManagementBtn');
            if (classManagementBtn) {
                classManagementBtn.addEventListener('click', function() {
                    showNotification('Ch·ª©c nƒÉng Qu·∫£n l√Ω L·ªõp ƒëang ƒë∆∞·ª£c ph√°t tri·ªÉn', 'info');
                });
            }

            // N√∫t B·∫£ng v·∫Ω
            const toggleMenuBtn = document.getElementById('toggleMenu');
            if (toggleMenuBtn) {
                toggleMenuBtn.addEventListener('click', function() {
                    showNotification('Ch·ª©c nƒÉng B·∫£ng v·∫Ω ƒëang ƒë∆∞·ª£c ph√°t tri·ªÉn', 'info');
                });
            }

            // N√∫t T√≠nh ƒëi·ªÉm
            const scoreBtn = document.getElementById('scoreBtn');
            if (scoreBtn) {
                scoreBtn.addEventListener('click', calculateFinalScore);
            }

            // N√∫t T∆∞∆°ng t√°c h·ªçc sinh
            const studentInteractBtn = document.getElementById('studentInteractBtn');
            if (studentInteractBtn) {
                studentInteractBtn.addEventListener('click', function() {
                    showNotification('Ch·ª©c nƒÉng T∆∞∆°ng t√°c ƒëang ƒë∆∞·ª£c ph√°t tri·ªÉn', 'info');
                });
            }

            // N√∫t Theo d√µi gi√°o vi√™n
            const teacherMonitorBtn = document.getElementById('teacherMonitorBtn');
            if (teacherMonitorBtn) {
                teacherMonitorBtn.addEventListener('click', function() {
                    showNotification('Ch·ª©c nƒÉng Theo d√µi ƒëang ƒë∆∞·ª£c ph√°t tri·ªÉn', 'info');
                });
            }

            console.log("‚úÖ Ho√†n t·∫•t g√°n s·ª± ki·ªán to√†n c·ª•c");
        }
        // ===== G√ÅN S·ª∞ KI·ªÜN CHO C√ÅC N√öT KI·ªÇM TRA =====
        function setupQuestionButtons() {
            console.log("üîß ƒêang g√°n s·ª± ki·ªán cho c√°c n√∫t ki·ªÉm tra...");
            
            // G√°n s·ª± ki·ªán cho t·∫•t c·∫£ c√°c n√∫t "Ki·ªÉm tra"
            document.querySelectorAll('button[onclick*="checkAnswer"]').forEach(button => {
                const match = button.getAttribute('onclick').match(/checkAnswer\('([^']+)',\s*'([^']+)'\)/);
                if (match) {
                    const qid = match[1];
                    const correct = match[2];
                    button.removeAttribute('onclick');
                    button.addEventListener('click', () => checkAnswer(qid, correct));
                    console.log(`  ‚úÖ G√°n s·ª± ki·ªán cho c√¢u: ${qid}`);
                }
            });
            
            // G√°n s·ª± ki·ªán cho n√∫t True/False
            document.querySelectorAll('button[onclick*="checkTrueFalseAnswer"]').forEach(button => {
                const match = button.getAttribute('onclick').match(/checkTrueFalseAnswer\('([^']+)',\s*(\[.*?\])\)/);
                if (match) {
                    const qid = match[1];
                    const correct = JSON.parse(match[2]);
                    button.removeAttribute('onclick');
                    button.addEventListener('click', () => checkTrueFalseAnswer(qid, correct));
                    console.log(`  ‚úÖ G√°n s·ª± ki·ªán True/False cho c√¢u: ${qid}`);
                }
            });
            
            // G√°n s·ª± ki·ªán cho n√∫t Short Answer
            document.querySelectorAll('button[onclick*="checkShortAnswer"]').forEach(button => {
                const match = button.getAttribute('onclick').match(/checkShortAnswer\('([^']+)',\s*'([^']+)'\)/);
                if (match) {
                    const qid = match[1];
                    const correct = match[2];
                    button.removeAttribute('onclick');
                    button.addEventListener('click', () => checkShortAnswer(qid, correct));
                    console.log(`  ‚úÖ G√°n s·ª± ki·ªán Short Answer cho c√¢u: ${qid}`);
                }
            });
            
            console.log(`‚úÖ ƒê√£ g√°n s·ª± ki·ªán cho ${document.querySelectorAll('button[onclick]').length} n√∫t`);
        }

        // ===== G√ÅN S·ª∞ KI·ªÜN CHO C√ÅC N√öT XEM GI·∫¢I =====
        function setupSolutionButtons() {
            document.querySelectorAll('button[onclick*="toggleSolution"]').forEach(button => {
                const match = button.getAttribute('onclick').match(/toggleSolution\('([^']+)'\)/);
                if (match) {
                    const qid = match[1];
                    button.removeAttribute('onclick');
                    button.addEventListener('click', () => toggleSolution(qid));
                }
            });
        }

        // ===== G√ÅN S·ª∞ KI·ªÜN CHO TOPBAR =====
        function setupTopbarEvents() {
            // N√∫t t√≠nh ƒëi·ªÉm
            const scoreBtn = document.getElementById('scoreBtn');
            if (scoreBtn) {
                scoreBtn.addEventListener('click', calculateFinalScore);
            }
            
            // N√∫t ƒëƒÉng nh·∫≠p
            const loginBtn = document.getElementById('loginBtn');
            if (loginBtn) {
                loginBtn.addEventListener('click', showLoginModal);
            }
            
            // N√∫t fullscreen
            const fullscreenBtn = document.getElementById('fullscreenBtn');
            if (fullscreenBtn) {
                fullscreenBtn.addEventListener('click', function() {
                    if (!document.fullscreenElement) {
                        document.documentElement.requestFullscreen();
                        this.textContent = 'üì∫ Exit';
                    } else {
                        document.exitFullscreen();
                        this.textContent = 'üì∫ Fullscreen';
                    }
                });
            }
            
            // N√∫t dark mode
            const styleBtn = document.getElementById('toggleStyleBtn');
            if (styleBtn) {
                styleBtn.addEventListener('click', function() {
                    document.documentElement.classList.toggle('dark-mode');
                    this.textContent = document.documentElement.classList.contains('dark-mode') 
                        ? '‚òÄÔ∏è Ch·∫ø ƒë·ªô s√°ng' 
                        : 'üåô Ch·∫ø ƒë·ªô t·ªëi';
                    
                    if (window.MathJax) {
                        MathJax.typesetPromise();
                    }
                });
            }
        }
        // ===== T·∫¢I DANH S√ÅCH ƒê·ªÄ =====
        async function loadExamList() {
            try {
                // Th·ª≠ t·∫£i t·ª´ server tr∆∞·ªõc
                const response = await fetch('exam-list.json');
                if (response.ok) {
                    const data = await response.json();
                    examList = data.exams || DEFAULT_EXAMS;
                } else {
                    // Fallback: d√πng danh s√°ch m·∫∑c ƒë·ªãnh
                    examList = DEFAULT_EXAMS;
                }
            } catch (error) {
                // N·∫øu kh√¥ng c√≥ file, d√πng m·∫∑c ƒë·ªãnh
                examList = DEFAULT_EXAMS;
            }
            
            renderExamList();
        }

        // ===== HI·ªÇN TH·ªä DANH S√ÅCH ƒê·ªÄ =====
        function renderExamList() {
            const grid = document.getElementById('exam-grid');
            
            // Nh√≥m ƒë·ªÅ theo category
            const categories = {};
            examList.forEach(exam => {
                if (!categories[exam.category]) {
                    categories[exam.category] = [];
                }
                categories[exam.category].push(exam);
            });
            
            let html = '';
            
            // Hi·ªÉn th·ªã t·ª´ng category
            Object.entries(categories).forEach(([category, exams]) => {
                html += `
                    <div style="grid-column: 1 / -1; margin-bottom: 10px;">
                        <h3 style="color: white; border-bottom: 2px solid rgba(255,255,255,0.3); padding-bottom: 8px;">
                            üìÅ ${category}
                        </h3>
                    </div>
                `;
                
                exams.forEach(exam => {
                    html += `
                        <div class="exam-card" data-exam-id="${exam.id}" onclick="selectExam('${exam.id}')">
                            <h3>
                                <span style="background: ${exam.color}; width: 20px; height: 20px; border-radius: 50%; display: inline-block;"></span>
                                ${exam.name}
                            </h3>
                            <p>${exam.description}</p>
                            <div class="exam-meta">
                                <span title="Th·ªùi gian">‚è∞ ${exam.time} ph√∫t</span>
                                <span title="S·ªë c√¢u">üìù ${exam.questions} c√¢u</span>
                                <span title="T·ªïng ƒëi·ªÉm">üìä ${(exam.questions * 0.4).toFixed(1)} ƒëi·ªÉm</span>
                            </div>
                            <div style="margin-top: 15px; font-size: 0.85em; color: rgba(255,255,255,0.6);">
                                ID: <code>${exam.id}</code> | Ng√†y: ${exam.created}
                            </div>
                        </div>
                    `;
                });
            });
            
            grid.innerHTML = html || `
                <div class="exam-card" style="text-align: center; padding: 40px; grid-column: 1 / -1;">
                    <div style="font-size: 3em; margin-bottom: 20px;">üì≠</div>
                    <h3>Ch∆∞a c√≥ ƒë·ªÅ thi n√†o</h3>
                    <p>Vui l√≤ng th√™m ƒë·ªÅ thi v√†o th∆∞ m·ª•c questions/</p>
                </div>
            `;
        }

        // ===== CH·ªåN ƒê·ªÄ THI =====
        function selectExam(examId) {
            console.log("B∆∞·ªõc 1: H√†m selectExam ƒë∆∞·ª£c g·ªçi v·ªõi ID:", examId);

            // B·ªè ch·ªçn t·∫•t c·∫£
            document.querySelectorAll('.exam-card').forEach(card => {
                card.classList.remove('active');
            });
            
            // Ch·ªçn ƒë·ªÅ ƒë∆∞·ª£c click
            const selectedCard = document.querySelector(`[data-exam-id="${examId}"]`);
            if (selectedCard) {
                selectedCard.classList.add('active');
            }
            
            // K√≠ch ho·∫°t n√∫t b·∫Øt ƒë·∫ßu
            document.getElementById('start-exam-btn').disabled = false;
            currentExam = examList.find(exam => exam.id === examId);
            
            console.log("B∆∞·ªõc 2: T√¨m th·∫•y th√¥ng tin ƒë·ªÅ thi:", currentExam);

            // C·∫≠p nh·∫≠t text n√∫t
            if (currentExam) {
                document.getElementById('start-exam-btn').innerHTML = `üöÄ B·∫Øt ƒë·∫ßu: ${currentExam.name}`;
            } else {
                console.error("L·ªñI: Kh√¥ng t√¨m th·∫•y th√¥ng tin ƒë·ªÅ thi c√≥ ID l√† '" + examId + "' trong bi·∫øn examList.");
            }
        }

        // ===== B·∫ÆT ƒê·∫¶U L√ÄM B√ÄI =====
               // ===== B·∫ÆT ƒê·∫¶U L√ÄM B√ÄI =====
        async function startExam() {
            console.log("B∆∞·ªõc 3: H√†m startExam ƒë∆∞·ª£c g·ªçi. B·∫Øt ƒë·∫ßu t·∫£i t·ªáp:", currentExam ? currentExam.file : "L·ªói: currentExam tr·ªëng!");

            if (!currentExam) {
                showNotification('Vui l√≤ng ch·ªçn m·ªôt ƒë·ªÅ thi!', 'warning');
                return;
            }
            
            try {
                showNotification(`ƒêang t·∫£i ƒë·ªÅ: ${currentExam.name}...`, 'info');
                
                // 1. T·∫£i c√¢u h·ªèi
                const response = await fetch(currentExam.file);
                if (!response.ok) throw new Error(`Kh√¥ng t·∫£i ƒë∆∞·ª£c file: ${currentExam.file}`);
                
                currentQuestions = await response.json();
                
                // 2. CHUY·ªÇN SANG TRANG L√ÄM B√ÄI (QUAN TR·ªåNG!)
                switchToExamPage();
                
                // 3. Hi·ªÉn th·ªã c√¢u h·ªèi
                renderExamQuestions();
                
                // 4. C·∫≠p nh·∫≠t giao di·ªán
                updateExamUI();
                
                // 5. KH·ªûI T·∫†O REVEAL.JS TR∆Ø·ªöC
                initializeReveal();
                
                // 6. CH·∫†Y C√ÅC H√ÄM SETUP SAU KHI DOM ƒê√É S·∫¥N S√ÄNG
                                // 6. CH·∫†Y C√ÅC H√ÄM SETUP RI√äNG CHO ƒê·ªÄ THI
                setTimeout(() => {
                    console.log("‚úÖ T·∫•t c·∫£ c√¢u h·ªèi ƒë√£ ƒë∆∞·ª£c t·∫£i, g√°n s·ª± ki·ªán cho ƒë·ªÅ thi...");
                    
                    // 6a. T·∫°o slide menu (ch·ªâ cho ƒë·ªÅ thi n√†y)
                    createSlideList();
                    
                    // 6b. G√ÅN S·ª∞ KI·ªÜN CHO C√ÅC N√öT "KI·ªÇM TRA" (ch·ªâ cho ƒë·ªÅ thi n√†y)
                    setupQuestionButtons();
                    
                    // 6c. G√°n s·ª± ki·ªán cho c√°c n√∫t gi·∫£i ƒë√°p (ch·ªâ cho ƒë·ªÅ thi n√†y)
                    setupSolutionButtons();
                    
                    showNotification(`‚úÖ ƒê√£ t·∫£i ƒë·ªÅ: ${currentExam.name}`, 'success');
                    
                }, 100);
                
            } catch (error) {
                console.error('L·ªói t·∫£i ƒë·ªÅ thi:', error);
                showNotification(`‚ùå L·ªói t·∫£i ƒë·ªÅ: ${error.message}`, 'error');
                
                // Fallback: hi·ªÉn th·ªã th√¥ng b√°o l·ªói
                const container = document.getElementById('questions-container');
                container.innerHTML = `
                    <section style="text-align: center; padding: 50px;">
                        <div style="font-size: 4em; margin-bottom: 20px;">‚ùå</div>
                        <h2 style="color: #dc3545;">L·ªói t·∫£i ƒë·ªÅ thi</h2>
                        <p>Kh√¥ng th·ªÉ t·∫£i ƒë·ªÅ thi: <strong>${currentExam.name}</strong></p>
                        <p style="color: #666;">L·ªói: ${error.message}</p>
                        <button onclick="switchToSelectionPage()" style="margin-top: 30px; padding: 12px 25px; background: #6c757d; color: white; border: none; border-radius: 8px; cursor: pointer;">
                            ‚Üê Quay l·∫°i trang ch·ªçn ƒë·ªÅ
                        </button>
                    </section>
                `;
            }
        }

        // ===== G√ÅN S·ª∞ KI·ªÜN CHO C√ÅC N√öT KI·ªÇM TRA =====
        function setupQuestionButtons() {
            console.log("üîß ƒêang g√°n s·ª± ki·ªán cho c√°c n√∫t ki·ªÉm tra...");
            
            // G√°n s·ª± ki·ªán cho t·∫•t c·∫£ c√°c n√∫t "Ki·ªÉm tra"
            document.querySelectorAll('button[onclick*="checkAnswer"]').forEach(button => {
                const match = button.getAttribute('onclick').match(/checkAnswer\('([^']+)',\s*'([^']+)'\)/);
                if (match) {
                    const qid = match[1];
                    const correct = match[2];
                    button.removeAttribute('onclick');
                    button.addEventListener('click', () => checkAnswer(qid, correct));
                    console.log(`  ‚úÖ G√°n s·ª± ki·ªán cho c√¢u: ${qid}`);
                }
            });
            
            // G√°n s·ª± ki·ªán cho n√∫t True/False
            document.querySelectorAll('button[onclick*="checkTrueFalseAnswer"]').forEach(button => {
                const match = button.getAttribute('onclick').match(/checkTrueFalseAnswer\('([^']+)',\s*(\[.*?\])\)/);
                if (match) {
                    const qid = match[1];
                    const correct = JSON.parse(match[2]);
                    button.removeAttribute('onclick');
                    button.addEventListener('click', () => checkTrueFalseAnswer(qid, correct));
                    console.log(`  ‚úÖ G√°n s·ª± ki·ªán True/False cho c√¢u: ${qid}`);
                }
            });
            
            // G√°n s·ª± ki·ªán cho n√∫t Short Answer
            document.querySelectorAll('button[onclick*="checkShortAnswer"]').forEach(button => {
                const match = button.getAttribute('onclick').match(/checkShortAnswer\('([^']+)',\s*'([^']+)'\)/);
                if (match) {
                    const qid = match[1];
                    const correct = match[2];
                    button.removeAttribute('onclick');
                    button.addEventListener('click', () => checkShortAnswer(qid, correct));
                    console.log(`  ‚úÖ G√°n s·ª± ki·ªán Short Answer cho c√¢u: ${qid}`);
                }
            });
            
            console.log(`‚úÖ ƒê√£ g√°n s·ª± ki·ªán cho ${document.querySelectorAll('button[onclick]').length} n√∫t`);
        }

        // ===== G√ÅN S·ª∞ KI·ªÜN CHO C√ÅC N√öT XEM GI·∫¢I =====
        function setupSolutionButtons() {
            document.querySelectorAll('button[onclick*="toggleSolution"]').forEach(button => {
                const match = button.getAttribute('onclick').match(/toggleSolution\('([^']+)'\)/);
                if (match) {
                    const qid = match[1];
                    button.removeAttribute('onclick');
                    button.addEventListener('click', () => toggleSolution(qid));
                }
            });
        }

        // ===== G√ÅN S·ª∞ KI·ªÜN CHO TOPBAR =====
        function setupTopbarEvents() {
            // N√∫t t√≠nh ƒëi·ªÉm
            const scoreBtn = document.getElementById('scoreBtn');
            if (scoreBtn) {
                scoreBtn.addEventListener('click', calculateFinalScore);
            }
            
            // N√∫t ƒëƒÉng nh·∫≠p
            const loginBtn = document.getElementById('loginBtn');
            if (loginBtn) {
                loginBtn.addEventListener('click', showLoginModal);
            }
            
            // N√∫t fullscreen
            const fullscreenBtn = document.getElementById('fullscreenBtn');
            if (fullscreenBtn) {
                fullscreenBtn.addEventListener('click', function() {
                    if (!document.fullscreenElement) {
                        document.documentElement.requestFullscreen();
                        this.textContent = 'üì∫ Exit';
                    } else {
                        document.exitFullscreen();
                        this.textContent = 'üì∫ Fullscreen';
                    }
                });
            }
            
            // N√∫t dark mode
            const styleBtn = document.getElementById('toggleStyleBtn');
            if (styleBtn) {
                styleBtn.addEventListener('click', function() {
                    document.documentElement.classList.toggle('dark-mode');
                    this.textContent = document.documentElement.classList.contains('dark-mode') 
                        ? '‚òÄÔ∏è Ch·∫ø ƒë·ªô s√°ng' 
                        : 'üåô Ch·∫ø ƒë·ªô t·ªëi';
                    
                    if (window.MathJax) {
                        MathJax.typesetPromise();
                    }
                });
            }
        }

        // ===== CHUY·ªÇN TRANG =====
                // ===== CHUY·ªÇN TRANG =====
                // ===== CHUY·ªÇN TRANG =====
        function switchToExamPage() {
            console.log("üîÑ ƒêang chuy·ªÉn sang trang l√†m b√†i...");
            
            const selectionPage = document.getElementById('exam-selection-page');
            const examPage = document.getElementById('exam-page');
            const backButton = document.getElementById('back-to-selection');
            
            if (!selectionPage || !examPage || !backButton) {
                console.error("‚ùå Kh√¥ng t√¨m th·∫•y c√°c ph·∫ßn t·ª≠ c·∫ßn thi·∫øt ƒë·ªÉ chuy·ªÉn trang");
                return;
            }
            
            // ·∫®n trang ch·ªçn ƒë·ªÅ
            selectionPage.classList.remove('active');
            console.log("‚úÖ ƒê√£ ·∫©n trang ch·ªçn ƒë·ªÅ");
            
            // Hi·ªán trang l√†m b√†i
            examPage.classList.add('active');
            console.log("‚úÖ ƒê√£ hi·ªán trang l√†m b√†i");
            
            // Hi·ªán n√∫t quay l·∫°i
            backButton.style.display = 'block';
            console.log("‚úÖ ƒê√£ hi·ªán n√∫t quay l·∫°i");
            
            // Cu·ªôn l√™n ƒë·∫ßu trang
            window.scrollTo(0, 0);
            
            console.log("üéØ Ki·ªÉm tra: Trang ch·ªçn ƒë·ªÅ active?", selectionPage.classList.contains('active'));
            console.log("üéØ Ki·ªÉm tra: Trang l√†m b√†i active?", examPage.classList.contains('active'));
        }

        function switchToSelectionPage() {
            document.getElementById('exam-page').classList.remove('active');
            document.getElementById('exam-selection-page').classList.add('active');
            document.getElementById('back-to-selection').style.display = 'none';
            
            // Reset Reveal.js
            if (revealInitialized) {
                Reveal.destroy();
                revealInitialized = false;
            }
            
            // Reset bi·∫øn
            currentQuestions = [];
            const container = document.getElementById('questions-container');
            if (container) container.innerHTML = '';
        }

        // ===== HI·ªÇN TH·ªä C√ÇU H·ªéI =====
        function renderExamQuestions() {
            const container = document.getElementById('questions-container');
            if (!container) return;
            
            container.innerHTML = '';
            
            // Th√™m slide ch√†o m·ª´ng t·ª´ JSON
            const welcomeQuestion = currentQuestions.find(q => q.type === 'info');
            if (welcomeQuestion) {
                const welcomeSlide = document.createElement('section');
                welcomeSlide.innerHTML = createWelcomeSlide(welcomeQuestion);
                container.appendChild(welcomeSlide);
            }
            
            // Th√™m c√°c c√¢u h·ªèi
            currentQuestions
                .filter(q => q.type !== 'info')
                .forEach((question) => {
                    const slide = document.createElement('section');
                    slide.innerHTML = createQuestionSlide(question);
                    container.appendChild(slide);
                });
        }

        // ===== T·∫†O SLIDE CH√ÄO M·ª™NG =====
        function createWelcomeSlide(question) {
            return `
                <div style="text-align: center; padding: 40px; max-width: 800px; margin: 0 auto;">
                    <h1 style="color: #1a237e; margin-bottom: 30px; font-size: 2.5em;">üßÆ ${currentExam.name}</h1>
                    <div style="font-size: 1.2em; color: #333; margin-bottom: 30px; line-height: 1.6;">
                        ${question.content || question.text}
                    </div>
                    <div style="background: linear-gradient(135deg, rgba(26, 35, 126, 0.1), rgba(57, 73, 171, 0.1)); padding: 30px; border-radius: 20px; display: inline-block; margin: 20px 0;">
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 25px; text-align: center;">
                            <div>
                                <div style="font-size: 2.5em; color: #1a237e;">‚è∞</div>
                                <div style="font-weight: bold; color: #1a237e; font-size: 1.3em;">${currentExam.time} ph√∫t</div>
                                <div style="font-size: 0.95em; color: #666; margin-top: 5px;">Th·ªùi gian</div>
                            </div>
                            <div>
                                <div style="font-size: 2.5em; color: #1a237e;">üìù</div>
                                <div style="font-weight: bold; color: #1a237e; font-size: 1.3em;">${currentExam.questions} c√¢u</div>
                                <div style="font-size: 0.95em; color: #666; margin-top: 5px;">S·ªë c√¢u</div>
                            </div>
                            <div>
                                <div style="font-size: 2.5em; color: #1a237e;">üìä</div>
                                <div style="font-weight: bold; color: #1a237e; font-size: 1.3em;">10 ƒëi·ªÉm</div>
                                <div style="font-size: 0.95em; color: #666; margin-top: 5px;">Thang ƒëi·ªÉm</div>
                            </div>
                            <div>
                                <div style="font-size: 2.5em; color: #1a237e;">üéØ</div>
                                <div style="font-weight: bold; color: #1a237e; font-size: 1.3em;">${currentExam.category}</div>
                                <div style="font-size: 0.95em; color: #666; margin-top: 5px;">Ph√¢n lo·∫°i</div>
                            </div>
                        </div>
                    </div>
                    <div style="margin-top: 40px;">
                        <button onclick="Reveal.next()" style="padding: 15px 40px; background: linear-gradient(135deg, #1a237e, #3949ab); color: white; border: none; border-radius: 12px; font-size: 1.2em; font-weight: bold; cursor: pointer; transition: all 0.3s ease;">
                            üöÄ B·∫Øt ƒë·∫ßu l√†m b√†i
                        </button>
                        <p style="margin-top: 15px; color: #666; font-size: 0.9em;">
                            Nh·∫•n n√∫t tr√™n ho·∫∑c ph√≠m m≈©i t√™n ‚Üí ƒë·ªÉ b·∫Øt ƒë·∫ßu
                        </p>
                    </div>
                </div>
            `;
        }

        // ===== T·∫†O SLIDE C√ÇU H·ªéI =====
        function createQuestionSlide(question) {
            switch(question.type) {
                case 'multiple_choice':
                    return createMultipleChoiceHTML(question);
                case 'true_false':
                    return createTrueFalseHTML(question);
                case 'short_answer':
                    return createShortAnswerHTML(question);
                default:
                    return `<div class="question">Kh√¥ng h·ªó tr·ª£ lo·∫°i c√¢u h·ªèi: ${question.type}</div>`;
            }
        }

        function createMultipleChoiceHTML(q) {
            const optionsHtml = ['A', 'B', 'C', 'D']
                .filter(option => q[option])
                .map(option => `
                    <div class="option-row">
                        <input type="radio" name="${q.id}" value="${option}" id="${q.id}${option}">
                        <label for="${q.id}${option}">${option}. ${q[option]}</label>
                        <span class="option-icon" id="icon-${q.id}-${option}"></span>
                    </div>
                `).join('');

            return `
                <div class="question" id="${q.id}">
                    <p class="question-title"><strong>${q.title}</strong> ${q.text}</p>
                    <div class="options">
                        ${optionsHtml}
                    </div>
                    <div class="answer-check">
                        <button onclick="checkAnswer('${q.id}', '${q.correct}')">‚úÖ Ki·ªÉm tra</button>
                        <span id="result-${q.id}"></span>
                    </div>
                    ${q.solution ? `
                        <button onclick="toggleSolution('${q.id}')" style="margin-top: 10px; padding: 8px 15px; background: #17a2b8; color: white; border: none; border-radius: 5px; cursor: pointer;">üëÅÔ∏è Xem gi·∫£i</button>
                        <div id="solution-${q.id}" class="solution-box" style="display: none;">
                            <div class="solution-title">H∆∞·ªõng d·∫´n gi·∫£i ${q.title}</div>
                            <div class="solution-content">${q.solution}</div>
                        </div>
                    ` : ''}
                </div>
            `;
        }

        function createTrueFalseHTML(q) {
            const subQuestions = ['a', 'b', 'c', 'd'].filter(letter => q[letter.toUpperCase()]);
            
            const optionsHtml = subQuestions.map((letter, idx) => {
                const questionText = q[letter.toUpperCase()];
                return `
                    <div class="option-row">
                        ${questionText}
                        <label style="margin-left: 15px;">
                            <input name="${q.id}${letter}" type="radio" value="True"/> ƒê√∫ng
                        </label>
                        <label style="margin-left: 10px;">
                            <input name="${q.id}${letter}" type="radio" value="False"/> Sai
                        </label>
                    </div>
                `;
            }).join('');

            return `
                <div class="question" id="${q.id}">
                    <p class="question-title"><strong>${q.title}</strong> ${q.text}</p>
                    <div class="options">
                        ${optionsHtml}
                    </div>
                    <div class="answer-check">
                        <button onclick="checkTrueFalseAnswer('${q.id}', ${JSON.stringify(q.correct)})">‚úÖ Ki·ªÉm tra</button>
                        <span id="result-${q.id}"></span>
                    </div>
                    ${q.solution ? `
                        <button onclick="toggleSolution('${q.id}')" style="margin-top: 10px; padding: 8px 15px; background: #17a2b8; color: white; border: none; border-radius: 5px; cursor: pointer;">üëÅÔ∏è Xem gi·∫£i</button>
                        <div id="solution-${q.id}" class="solution-box" style="display: none;">
                            <div class="solution-title">H∆∞·ªõng d·∫´n gi·∫£i ${q.title}</div>
                            <div class="solution-content">${q.solution}</div>
                        </div>
                    ` : ''}
                </div>
            `;
        }

        function createShortAnswerHTML(q) {
            return `
                <div class="question" id="${q.id}">
                    <p class="question-title"><strong>${q.title}</strong> ${q.text}</p>
                    <div class="answer-check">
                        <input id="input-${q.id}" placeholder="Nh·∫≠p k·∫øt qu·∫£..." type="text" style="width: 200px;"/>
                        <button onclick="checkShortAnswer('${q.id}', '${q.correct}')">‚úÖ Ki·ªÉm tra</button>
                        <span id="icon-${q.id}"></span>
                    </div>
                    <div id="result-${q.id}"></div>
                    ${q.solution ? `
                        <button onclick="toggleSolution('${q.id}')" style="margin-top: 10px; padding: 8px 15px; background: #17a2b8; color: white; border: none; border-radius: 5px; cursor: pointer;">üëÅÔ∏è Xem gi·∫£i</button>
                        <div id="solution-${q.id}" class="solution-box" style="display: none;">
                            <div class="solution-title">H∆∞·ªõng d·∫´n gi·∫£i ${q.title}</div>
                            <div class="solution-content">${q.solution}</div>
                        </div>
                    ` : ''}
                </div>
            `;
        }

        // ===== C·∫¨P NH·∫¨T UI =====
        function updateExamUI() {
            // C·∫≠p nh·∫≠t title
            document.getElementById('current-exam-title').textContent = 
                `L·ªöP TO√ÅN TH·∫¶Y B√åNH - ${currentExam.name}`;
            
            // C·∫≠p nh·∫≠t dropdown ch·ªçn ƒë·ªÅ
            const select = document.getElementById('selectExam');
            select.innerHTML = '<option value="mm">-- Ch·ªçn ƒë·ªÅ --</option>';
            
            examList.forEach(exam => {
                const option = document.createElement('option');
                option.value = exam.id;
                option.textContent = exam.name;
                option.selected = exam.id === currentExam.id;
                select.appendChild(option);
            });
            
            // Th√™m event listener cho dropdown
            select.addEventListener('change', function(e) {
                if (e.target.value !== 'mm') {
                    const examName = this.options[this.selectedIndex].text;
                    const confirmChange = confirm(`Chuy·ªÉn sang ƒë·ªÅ: ${examName}?\nB√†i l√†m hi·ªán t·∫°i s·∫Ω b·ªã m·∫•t.`);
                    if (confirmChange) {
                        selectExam(e.target.value);
                        startExam();
                    } else {
                        // Reset v·ªÅ ƒë·ªÅ hi·ªán t·∫°i
                        this.value = currentExam.id;
                    }
                }
            });
        }

        // ===== KH·ªûI T·∫†O REVEAL.JS =====
               // H√ÄM CHU·∫®N V√Ä ƒê√öNG (KH√îNG QU·∫¢N L√ù MATHJAX)
function initializeReveal() {
    if (revealInitialized) {
        Reveal.destroy();
    }
    
    Reveal.initialize({
        width: "100%", 
        height: "100%", 
        margin: 0.02, 
        minScale: 0.2, 
        maxScale: 2,
        slideNumber: 'c/t',
        hash: true,
        plugins: [RevealMarkdown, RevealHighlight, RevealNotes, RevealMath], // V·∫´n gi·ªØ plugin math.js
        
        // B·ªé HO√ÄN TO√ÄN KH·ªêI C·∫§U H√åNH "math"
        
        transition: 'slide',
        backgroundTransition: 'fade',
        controls: true,
        progress: true,
        center: true
    });
    
    revealInitialized = true;
    
    // Th√™m event listener cho slide change
    Reveal.addEventListener('slidechanged', function(event) {
        updateActiveSlideInMenu();
    });
    
    // Th√™m listener cho s·ª± ki·ªán ready
    Reveal.addEventListener('ready', function(event) {
        console.log("‚úÖ Reveal.js ƒë√£ s·∫µn s√†ng!");
        // G·ªçi typeset th·ªß c√¥ng ƒë·ªÉ ch·∫Øc ch·∫Øn c√¥ng th·ª©c to√°n ƒë∆∞·ª£c render
        if (window.MathJax && typeof MathJax.typesetPromise === 'function') {
            MathJax.typesetPromise();
        }
    });
}
        // ===== SLIDE MENU =====
        function createSlideList() {
            const slideList = document.getElementById('slideList');
            if (!slideList) return;
            
            const slides = document.querySelectorAll('.reveal .slides section');
            slideList.innerHTML = Array.from(slides).map((slide, index) => {
                const title = slide.querySelector('.question-title')?.textContent.substring(0, 30) || 
                            slide.querySelector('h1, h2, h3')?.textContent.substring(0, 30) || 
                            `Slide ${index + 1}`;
                return `<div class="slide-item" data-slide-index="${index}">
                            <span class="slide-number">${index + 1}</span>${title}
                        </div>`;
            }).join('');

            slideList.querySelectorAll('.slide-item').forEach(item => {
                item.addEventListener('click', () => {
                    Reveal.slide(parseInt(item.dataset.slideIndex));
                    document.getElementById('slideMenu').classList.remove('active');
                    document.getElementById('menuOverlay').classList.remove('active');
                });
            });
            
            updateActiveSlideInMenu();
        }

        function updateActiveSlideInMenu() {
            const slideList = document.getElementById('slideList');
            if (!slideList || !Reveal.getIndices) return;
            
            const indices = Reveal.getIndices();
            if (!indices) return;
            
            const currentIndex = indices.h;
            document.querySelectorAll('.slide-item').forEach((item, index) => {
                item.classList.toggle('active', index === currentIndex);
            });
        }

        // ===== MODAL ƒêƒÇNG NH·∫¨P =====
        function showLoginModal() {
            const modal = document.getElementById('login-modal');
            if (modal) {
                modal.classList.add('active');
            } else {
                // T·∫°o modal ƒëƒÉng nh·∫≠p n·∫øu ch∆∞a c√≥
                createLoginModal();
            }
        }

        function createLoginModal() {
            const modalHTML = `
                <div class="modal" id="login-modal">
                    <div class="modal-content">
                        <button class="modal-close" onclick="this.closest('.modal').classList.remove('active')">√ó</button>
                        <h3>üîê ƒêƒÉng nh·∫≠p h·ªá th·ªëng</h3>
                        <form id="code-login-form" onsubmit="handleLogin(event)">
                            <div style="margin-bottom: 15px;">
                                <label style="display: block; margin-bottom: 5px; font-weight: 600;">M√£ ƒëƒÉng nh·∫≠p:</label>
                                <input id="login-code" placeholder="Nh·∫≠p m√£ h·ªçc sinh/gi√°o vi√™n" required type="text"/>
                            </div>
                            <div style="margin-bottom: 20px;">
                                <label style="display: block; margin-bottom: 5px; font-weight: 600;">H·ªç t√™n:</label>
                                <input id="student-name" placeholder="Nh·∫≠p h·ªç t√™n c·ªßa b·∫°n" type="text"/>
                            </div>
                            <div style="display:flex;gap:10px;justify-content:flex-end;margin-top:20px;">
                                <button type="submit" style="flex: 1; padding: 12px; background: #1a237e; color: white; border: none; border-radius: 8px; font-weight: 600;">üöÄ ƒêƒÉng nh·∫≠p</button>
                            </div>
                        </form>
                        <div id="auth-status" style="margin-top: 15px;"></div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalHTML);
            
            // Th√™m event listener
            document.getElementById('code-login-form').addEventListener('submit', handleLogin);
        }

        async function handleLogin(e) {
            if (e) e.preventDefault();
            
            const code = document.getElementById('login-code').value.trim();
            const name = document.getElementById('student-name').value.trim() || 'H·ªçc sinh';
            
            if (!code) {
                showNotification('Vui l√≤ng nh·∫≠p m√£ ƒëƒÉng nh·∫≠p', 'error');
                return;
            }

            try {
                if (code === 'admin79') {
                    // Gi√°o vi√™n
                    isTeacherLoggedIn = true;
                    currentUser = { uid: 'teacher_admin_79', name, role: 'teacher', code: 'admin79' };
                    showNotification(`‚úÖ ƒêƒÉng nh·∫≠p th√†nh c√¥ng - GV: ${name}`, 'success');
                    updateUIAfterLogin();
                } else if (code.startsWith('HS')) {
                    // H·ªçc sinh
                    isTeacherLoggedIn = false;
                    currentUser = { uid: 'student_' + code + '_' + Date.now(), name, role: 'student', code };
                    showNotification(`‚úÖ ƒêƒÉng nh·∫≠p th√†nh c√¥ng - HS: ${name}`, 'success');
                    updateUIAfterLogin();
                } else {
                    showNotification('M√£ ƒëƒÉng nh·∫≠p kh√¥ng h·ª£p l·ªá', 'error');
                }
            } catch (error) {
                console.error('Login error:', error);
                showNotification('L·ªói ƒëƒÉng nh·∫≠p: ' + error.message, 'error');
            }
        }

        function updateUIAfterLogin() {
            const modal = document.getElementById('login-modal');
            if (modal) modal.classList.remove('active');
            
            const loginBtn = document.getElementById('loginBtn');
            if (loginBtn) {
                if (isTeacherLoggedIn) {
                    loginBtn.innerHTML = 'üë®‚Äçüè´ ' + currentUser.name;
                    loginBtn.style.background = '#28a745';
                } else {
                    loginBtn.innerHTML = 'üë§ ' + currentUser.name;
                }
            }
            
            // Hi·ªÉn th·ªã n√∫t t∆∞∆°ng t√°c cho h·ªçc sinh
            const interactBtn = document.getElementById('studentInteractBtn');
            if (interactBtn && !isTeacherLoggedIn) {
                interactBtn.style.display = 'inline-block';
            }
            
            // Hi·ªÉn th·ªã n√∫t theo d√µi cho gi√°o vi√™n
            const monitorBtn = document.getElementById('teacherMonitorBtn');
            if (monitorBtn && isTeacherLoggedIn) {
                monitorBtn.style.display = 'inline-block';
            }
        }

        // ===== H√ÄM KI·ªÇM TRA ƒê√ÅP √ÅN =====
        window.checkAnswer = function(qid, correct) {
            try {
                const container = document.getElementById(qid);
                if (!container) {
                    showNotification('Kh√¥ng t√¨m th·∫•y c√¢u h·ªèi!', 'error');
                    return;
                }

                // X√≥a icon c≈©
                container.querySelectorAll('.option-icon').forEach(el => el.textContent = '');

                // L·∫•y l·ª±a ch·ªçn
                const chosen = container.querySelector(`input[name="${qid}"]:checked`);
                if (!chosen) {
                    showNotification("H√£y ch·ªçn m·ªôt ƒë√°p √°n!", 'warning');
                    return;
                }

                const chosenVal = chosen.value;
                const resultArea = container.querySelector(".answer-check");

                // T·∫°o v√πng th√¥ng b√°o
                let feedback = resultArea.querySelector(".result");
                if (!feedback) {
                    feedback = document.createElement("div");
                    feedback.className = "result";
                    feedback.style.marginTop = "10px";
                    feedback.style.padding = "12px";
                    feedback.style.background = "rgba(255,255,255,0.9)";
                    feedback.style.borderRadius = "8px";
                    feedback.style.border = "1px solid #e0e0e0";
                    feedback.style.fontSize = "0.95em";
                    resultArea.appendChild(feedback);
                }

                if (chosenVal === correct) {
                    // ƒê√°p √°n ƒë√∫ng
                    const userOption = chosen.closest('.option-row');
                    const icon = userOption.querySelector('.option-icon');
                    if (icon) icon.textContent = '‚úÖ';
                    
                    feedback.innerHTML = `
                        <div style="color: #28a745; font-weight: bold; display: flex; align-items: center; gap: 8px;">
                            <span>‚úÖ</span>
                            <span><b>Ch√≠nh x√°c!</b></span>
                        </div>
                        <div style="margin-top: 8px; padding: 8px; background: #d4edda; border-radius: 6px;">
                            ƒê√°p √°n c·ªßa b·∫°n: <b>${chosenVal}</b>
                        </div>
                    `;
                    
                    // ƒê√°nh d·∫•u t·∫•t c·∫£ options
                    container.querySelectorAll('.option-row').forEach(row => {
                        const radio = row.querySelector('input[type="radio"]');
                        radio.disabled = true;
                        if (radio.value === correct) {
                            row.style.background = 'linear-gradient(135deg, #d4edda, #c3e6cb)';
                            row.style.borderColor = '#28a745';
                        }
                    });
                    
                    showNotification(`‚úÖ C√¢u ${qid}: Ch√≠nh x√°c!`, 'success');
                    
                } else {
                    // ƒê√°p √°n sai
                    const userOption = chosen.closest('.option-row');
                    const correctOption = container.querySelector(`input[value="${correct}"]`).closest('.option-row');
                    
                    const userIcon = userOption?.querySelector('.option-icon');
                    const correctIcon = correctOption?.querySelector('.option-icon');
                    
                    if (userIcon) userIcon.textContent = '‚ùå';
                    if (correctIcon) correctIcon.textContent = '‚úÖ';
                    
                    feedback.innerHTML = `
                        <div style="color: #dc3545; font-weight: bold; display: flex; align-items: center; gap: 8px;">
                            <span>‚ùå</span>
                            <span><b>Sai r·ªìi.</b></span>
                        </div>
                        <div style="margin-top: 8px; padding: 8px; background: #f8d7da; border-radius: 6px;">
                            B·∫°n ch·ªçn: <b>${chosenVal}</b>
                        </div>
                        <div style="margin-top: 5px; padding: 8px; background: #d4edda; border-radius: 6px;">
                            ƒê√°p √°n ƒë√∫ng: <b style="color: #28a745">${correct}</b>
                        </div>
                    `;
                    
                    // ƒê√°nh d·∫•u t·∫•t c·∫£ options
                    container.querySelectorAll('.option-row').forEach(row => {
                        const radio = row.querySelector('input[type="radio"]');
                        radio.disabled = true;
                        const value = radio.value;
                        if (value === correct) {
                            row.style.background = 'linear-gradient(135deg, #d4edda, #c3e6cb)';
                            row.style.borderColor = '#28a745';
                        } else if (value === chosenVal) {
                            row.style.background = 'linear-gradient(135deg, #f8d7da, #f5c6cb)';
                            row.style.borderColor = '#dc3545';
                        }
                    });
                    
                    showNotification(`‚ùå C√¢u ${qid}: Ch∆∞a ch√≠nh x√°c`, 'error');
                }
                
            } catch (error) {
                console.error('L·ªói trong checkAnswer:', error);
                showNotification('C√≥ l·ªói x·∫£y ra khi ki·ªÉm tra ƒë√°p √°n!', 'error');
            }
        };

        window.checkTrueFalseAnswer = function(questionId, correctAnswers) {
            const container = document.getElementById(questionId);
            if (!container) return;

            const optionRows = container.querySelectorAll(".option-row");
            let allCorrect = true;
            let feedbackHtml = '';
            let score = 0;

            optionRows.forEach((row, idx) => {
                const radios = row.querySelectorAll("input[type='radio']");
                let selected = null;
                radios.forEach(r => { if (r.checked) selected = r.value; });

                const expected = (correctAnswers[idx] && String(correctAnswers[idx]).toLowerCase().startsWith('t')) ? 'True' : 'False';
                const letter = String.fromCharCode(97 + idx);

                if (selected === null) {
                    feedbackHtml += `M·ªánh ƒë·ªÅ ${letter}) ‚≠ï Ch∆∞a ch·ªçn<br>`;
                    allCorrect = false;
                } else if (selected === expected) {
                    feedbackHtml += `M·ªánh ƒë·ªÅ ${letter}) ‚úÖ ƒê√∫ng<br>`;
                    score += 0.25;
                } else {
                    feedbackHtml += `M·ªánh ƒë·ªÅ ${letter}) ‚ùå Sai (ch·ªçn ${selected})<br>`;
                    allCorrect = false;
                }
            });

            // Hi·ªÉn th·ªã k·∫øt qu·∫£
            let resultBox = container.querySelector(".answer-check .result");
            if (!resultBox) {
                resultBox = document.createElement('div');
                resultBox.className = 'result';
                resultBox.style.marginTop = '8px';
                resultBox.style.padding = '12px';
                resultBox.style.background = 'rgba(255,255,255,0.9)';
                resultBox.style.borderRadius = '8px';
                resultBox.style.border = '1px solid #e0e0e0';
                container.querySelector(".answer-check").appendChild(resultBox);
            }
            
            resultBox.innerHTML = `
                <div style="font-weight: bold; margin-bottom: 8px;">üìä K·∫øt qu·∫£ ki·ªÉm tra:</div>
                ${feedbackHtml}
                <div style="margin-top: 8px; font-weight: bold; color: ${allCorrect ? '#28a745' : '#ffc107'}">
                    ƒêi·ªÉm: ${score}/1.00
                </div>
            `;

            // Kh√≥a inputs
            container.querySelectorAll("input[type='radio']").forEach(r => r.disabled = true);

            if (allCorrect) {
                showNotification(`‚úÖ C√¢u ${questionId}: Ho√†n to√†n ch√≠nh x√°c!`, 'success');
            } else {
                showNotification(`‚ö†Ô∏è C√¢u ${questionId}: ƒê√∫ng ${score * 4}/4 m·ªánh ƒë·ªÅ`, 'warning');
            }
        };

        window.checkShortAnswer = function(qid, correct) {
            const input = document.getElementById(`input-${qid}`);
            const icon = document.getElementById(`icon-${qid}`);
            const resultBox = input?.closest(".answer-check");

            if (!input) return;

            const userAnswer = input.value.trim();

            // T·∫°o v√πng th√¥ng b√°o
            let feedback = resultBox.querySelector(".result");
            if (!feedback) {
                feedback = document.createElement("div");
                feedback.className = "result";
                feedback.style.marginTop = "10px";
                feedback.style.padding = "12px";
                feedback.style.borderRadius = "8px";
                feedback.style.background = "rgba(255,255,255,0.9)";
                feedback.style.border = "1px solid #e0e0e0";
                feedback.style.fontSize = "0.95em";
                resultBox.appendChild(feedback);
            }

            if (userAnswer === "") {
                icon.textContent = "‚ö†Ô∏è";
                feedback.innerHTML = "‚ùó <b>B√°o th·∫ßy ki·ªÉm tr·ª±c ti·∫øp v√¨ ch∆∞a gi·∫£i.</b>";
                return;
            }

            // Chu·∫©n h√≥a ƒë√°p √°n
            const normalizedUser = userAnswer.toLowerCase().replace(/\s+/g, '');
            const normalizedCorrect = correct.trim().toLowerCase().replace(/\s+/g, '');

            if (normalizedUser === normalizedCorrect) {
                icon.textContent = "‚úÖ";
                feedback.innerHTML = `
                    <div style="color: #28a745; font-weight: bold;">
                        üéØ <b>ƒê√∫ng r·ªìi!</b>
                    </div>
                    <div style="margin-top: 5px;">ƒê√°p √°n c·ªßa b·∫°n: <b>${userAnswer}</b></div>
                `;
                input.style.borderColor = '#28a745';
                input.style.background = '#d4edda';
                input.disabled = true;
                
                showNotification(`‚úÖ C√¢u ${qid}: Ch√≠nh x√°c!`, 'success');
            } else {
                icon.textContent = "‚ùå";
                feedback.innerHTML = `
                    <div style="color: #dc3545; font-weight: bold;">
                        ‚ùå <b>Sai r·ªìi.</b>
                    </div>
                    <div style="margin-top: 5px;">ƒê√°p √°n c·ªßa b·∫°n: <b>${userAnswer}</b></div>
                    <div>ƒê√°p √°n ƒë√∫ng l√†: <b style="color: #28a745">${correct}</b></div>
                `;
                input.style.borderColor = '#dc3545';
                input.style.background = '#f8d7da';
                input.disabled = true;
                
                showNotification(`‚ùå C√¢u ${qid}: Ch∆∞a ch√≠nh x√°c`, 'error');
            }
        };

        window.toggleSolution = function(questionId) {
            const solution = document.getElementById('solution-' + questionId);
            if (solution) {
                solution.style.display = solution.style.display === 'none' ? 'block' : 'none';
            }
        };

        window.calculateFinalScore = async function() {
            if (isTeacherLoggedIn) {
                showNotification("Gi√°o vi√™n kh√¥ng t√≠nh ƒëi·ªÉm.", "info");
                return;
            }
            
            if (!currentUser) {
                showNotification("Vui l√≤ng ƒëƒÉng nh·∫≠p tr∆∞·ªõc khi t√≠nh ƒëi·ªÉm.", "warning");
                return;
            }

            const studentAnswers = {};
            const correctAnswers = {};
            let totalScore = 0;

            // Thu th·∫≠p ƒë√°p √°n ƒë√∫ng
            currentQuestions
                .filter(q => q.type !== 'info')
                .forEach(q => {
                    if (q.correct) {
                        correctAnswers[q.id] = q.correct;
                    }
                });

            // Thu th·∫≠p ƒë√°p √°n h·ªçc sinh
            currentQuestions
                .filter(q => q.type !== 'info')
                .forEach(q => {
                    if (q.type === 'multiple_choice') {
                        const selected = document.querySelector(`input[name="${q.id}"]:checked`);
                        studentAnswers[q.id] = selected ? selected.value : '';
                    } else if (q.type === 'true_false') {
                        const subAnswers = [];
                        ['a','b','c','d'].forEach(letter => {
                            const sel = document.querySelector(`input[name="${q.id}${letter}"]:checked`);
                            subAnswers.push(sel ? sel.value : '');
                        });
                        studentAnswers[q.id] = subAnswers;
                    } else if (q.type === 'short_answer') {
                        const el = document.getElementById(`input-${q.id}`);
                        studentAnswers[q.id] = el ? el.value.trim() : '';
                    }
                });

            // T√≠nh ƒëi·ªÉm
            Object.keys(correctAnswers).forEach(qid => {
                const userAns = studentAnswers[qid];
                const corr = correctAnswers[qid];
                
                if (Array.isArray(corr)) {
                    // True/False
                    if (Array.isArray(userAns)) {
                        let correctCount = 0;
                        for (let i = 0; i < corr.length && i < userAns.length; i++) {
                            const exp = String(corr[i]).toLowerCase();
                            const u = String(userAns[i]).toLowerCase();
                            if (u && (u === exp || 
                                (exp.startsWith('t') && u.startsWith('t')) || 
                                (exp.startsWith('ƒë') && u.startsWith('ƒë')))) {
                                correctCount++;
                            }
                        }
                        
                        if (correctCount === 1) totalScore += 0.1;
                        else if (correctCount === 2) totalScore += 0.25;
                        else if (correctCount === 3) totalScore += 0.5;
                        else if (correctCount === 4) totalScore += 1;
                    }
                } else {
                    // Multiple choice ho·∫∑c short answer
                    if (userAns && String(userAns).toUpperCase() === String(corr).toUpperCase()) {
                        totalScore += qid.startsWith('q') && parseInt(qid.substring(1)) <= 12 ? 0.25 : 0.5;
                    }
                }
            });

            // Hi·ªÉn th·ªã k·∫øt qu·∫£
            const finalScore = Math.min(totalScore, 10).toFixed(2);
            const scoreColor = finalScore >= 8 ? '#28a745' : finalScore >= 5 ? '#ffc107' : '#dc3545';
            const scoreEmoji = finalScore >= 8 ? 'üèÜ' : finalScore >= 5 ? '‚úÖ' : '‚ùå';
            
            const resultBox = document.createElement('div');
            resultBox.id = 'score-result';
            resultBox.style.cssText = `
                position: fixed; 
                bottom: 20px; 
                right: 20px; 
                background: rgba(0,0,0,0.9); 
                color: #fff; 
                padding: 25px; 
                border-radius: 15px; 
                z-index: 99999; 
                font-size: 16px;
                max-width: 350px;
                box-shadow: 0 10px 30px rgba(0,0,0,0.4);
                border: 3px solid ${scoreColor};
            `;
            
            resultBox.innerHTML = `
                <div style="text-align: center; margin-bottom: 15px;">
                    <div style="font-size: 3em; margin-bottom: 10px;">${scoreEmoji}</div>
                    <div style="font-size: 2em; font-weight: bold; color: ${scoreColor};">
                        ${finalScore} / 10.00
                    </div>
                </div>
                <div style="font-size: 1em; text-align: center; margin-bottom: 15px;">
                    ${finalScore >= 8 ? 'üèÖ Xu·∫•t s·∫Øc! üéâ' : 
                      finalScore >= 5 ? 'üëç ƒê·∫°t y√™u c·∫ßu!' : 
                      'üí™ C·∫ßn c·ªë g·∫Øng th√™m!'}
                </div>
                <div style="font-size: 0.9em; color: #aaa; text-align: center;">
                    ƒê·ªÅ: ${currentExam.name}<br>
                    H·ªçc sinh: ${currentUser.name}
                </div>
            `;
            
            // X√≥a k·∫øt qu·∫£ c≈© n·∫øu c√≥
            const oldResult = document.getElementById('score-result');
            if (oldResult) oldResult.remove();
            
            document.body.appendChild(resultBox);
            
            // T·ª± ƒë·ªông x√≥a sau 15 gi√¢y
            setTimeout(() => {
                if (resultBox.parentNode) {
                    resultBox.style.opacity = '0';
                    resultBox.style.transition = 'opacity 0.5s';
                    setTimeout(() => {
                        if (resultBox.parentNode) resultBox.remove();
                    }, 500);
                }
            }, 15000);
            
            showNotification(`üìä ƒêi·ªÉm c·ªßa b·∫°n: ${finalScore}/10`, 'success');
        };

        // ===== H√ÄM HI·ªÇN TH·ªä TH√îNG B√ÅO =====
        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            if (!notification) return;
            
            notification.innerHTML = message;
            notification.className = `notification ${type}`;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 5000);
        }

        // ===== H√ÄM TI·ªÜN √çCH =====
        window.addEventListener('keydown', function(e) {
            // F11: Fullscreen
            if (e.key === 'F11') {
                e.preventDefault();
                if (!document.fullscreenElement) {
                    document.documentElement.requestFullscreen();
                } else {
                    document.exitFullscreen();
                }
            }
            
            // ESC: Tho√°t fullscreen
            if (e.key === 'Escape' && document.fullscreenElement) {
                document.exitFullscreen();
            }
        });

        console.log("üöÄ H·ªá th·ªëng L·ªõp To√°n Th·∫ßy B√¨nh ƒë√£ kh·ªüi ch·∫°y th√†nh c√¥ng!");
    </script>
    
</body>
</html>